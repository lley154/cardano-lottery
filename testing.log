#### MAY 5, 2022 
###################################### DEVNET ################################

 [nix-shell:~/src/cardano-node]$ cardano-cli transaction build \
  --alonzo-era \
  --cardano-mode \
  --testnet-magic 42 \
  --tx-in "38422a5d7d8251207f786610b7c4ff50fb705731111756c870a3b15d4d164fb2#0" \
  --tx-out "addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5+1000000000" \
  --tx-out "addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5+10000000" \
  --tx-out "addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju+1000000000" \
  --tx-out "addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju+10000000" \
  --tx-out "addr_test1vzzrzjrckm7udfjm8jvfsw3t4w8zw989my85az49460sy6qmfy687+1000000000" \
  --tx-out "addr_test1vzzrzjrckm7udfjm8jvfsw3t4w8zw989my85az49460sy6qmfy687+10000000" \
  --change-address "addr_test1vp5nk36pnx4gkd9mk44gx35m7e7el3nxgxhu2m484aurnwcc75528" \
  --out-file "$WORK/transfer-tx-alonzo.body"
  
  [nix-shell:~/src/cardano-node]$ cardano-cli transaction sign \
  --tx-body-file "$WORK/transfer-tx-alonzo.body" \
  --testnet-magic 42 \
  --signing-key-file "/home/lawrence/.cache/cardano-workbench/genesis/k3-d1-0.003kD-0kU-9082bbc/utxo-keys/utxo1.skey" \ 

[nix-shell:~/src/cardano-node]$ cardano-cli transaction submit --tx-file $WORK/transfer-tx-alonzo.tx --testnet-magic 42
/nix/store/jnf78clpqljssksprypgp7rarfr9wj30-cabal-install-exe-cabal-3.6.2.0/bin/cabal --project-file=/home/lawrence/src/cardano-node/.nix-shell-cabal.project -v0 run exe:cardano-cli -- transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/transfer-tx-alonzo.tx --testnet-magic 42
Transaction successfully submitted.



lawrence@lawrence-MacBookAir:~/src/cardano-lottery/scripts/cardano-cli/devnet$ ./run-devnet-test.sh 
+ '[' -z devnet ']'
+ ENV=devnet
+++ readlink -f ./init-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/init-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ export TESTNET_MAGIC=42
++ TESTNET_MAGIC=42
++ export ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#2
++ ADMIN_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#2
++ export PLAYER_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#4
++ PLAYER_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#4
++ export SPONSOR_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#6
++ SPONSOR_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#6
+ echo 'Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket'
Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ ls -al /home/lawrence/src/cardano-node/run/current/node-0/node.socket
srwxr-xr-x 1 lawrence lawrence 0 May  5 17:35 /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ rm -f /home/lawrence/src/cardano-lottery/work/pparms.json
+ rm -f '/home/lawrence/src/cardano-lottery/work-backup/*'
+ ticket_cost=20000
+ initial_funding=10000000
+ fee_percentage=2
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
+ minting_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-thread-token-policy.plutus
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ lotto_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --testnet-magic 42
+ lotto_validator_script_addr=addr_test1wzutcjsh63tg2xj903fqaan5yaw5d9tfzc840yjtnmn7x3gzpqvuj
+ redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-thread-token-mint.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7
++ cat /home/lawrence/.local/keys/devnet/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
++ cat /home/lawrence/.local/keys/devnet/03.pkh
+ sponsor_pkh=84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268
+ echo 'starting lotto init'
starting lotto init
+ echo 'Script: /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus'
Script: /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 42 --payment-verification-key-file /home/lawrence/.local/keys/devnet/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#1
++ tr -d '\n'
+ admin_utxo_in=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#1
+ cp /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-datum-init.datum /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 42 --tx-in 08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#1 --tx-in-collateral 08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#2 --mint-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-thread-token-policy.plutus --mint-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-thread-token-mint.json --tx-out 'addr_test1wzutcjsh63tg2xj903fqaan5yaw5d9tfzc840yjtnmn7x3gzpqvuj+10000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --mint '1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7' --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body
Estimated transaction fee: Lovelace 100671
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body --testnet-magic 42 --signing-key-file /home/lawrence/.local/keys/devnet/01.skey --out-file /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx --testnet-magic 42
Transaction successfully submitted.

 please confirm before proceeding that you see the init tx on the blockchain
 
 
 [nix-shell:/home/lawrence/src/cardano-lottery]$ cardano-cli query utxo --address addr_test1wzutcjsh63tg2xj903fqaan5yaw5d9tfzc840yjtnmn7x3gzpqvuj --cardano-mode --testnet-magic 42
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
0c3ce05e4089d3992e78c15071465ccdfcd91dd158394503b3b638bf2af6050b     1        10000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7 + TxOutDatumHash ScriptDataInAlonzoEra "dd9c151fd36723f6460f7499c0f8623d63efd5b611379fa62f1e45780f21ba02"

 
 
+ '[' -z devnet ']'
+ ENV=devnet
+++ readlink -f ./open-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/open-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ export TESTNET_MAGIC=42
++ TESTNET_MAGIC=42
++ export ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#2
++ ADMIN_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#2
++ export PLAYER_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#4
++ PLAYER_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#4
++ export SPONSOR_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#6
++ SPONSOR_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#6
+ echo 'Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket'
Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ ls -al /home/lawrence/src/cardano-node/run/current/node-0/node.socket
srwxr-xr-x 1 lawrence lawrence 0 May  5 17:35 /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work-backup
+ ticket_cost=20000
+ additional_funding=10000000
+ fee_percentage=2
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.hash
+ lotto_validator_hash='{"bytes":"b8bc4a17d456851a457c520ef674275d469569160f57924b9ee7e345"}'
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --testnet-magic 42
+ lotto_validator_script_addr=addr_test1wzutcjsh63tg2xj903fqaan5yaw5d9tfzc840yjtnmn7x3gzpqvuj
+ redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-open.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-val-addr.json
+ lotto_validator_addr='{"fields":[{"fields":[{"bytes":"b8bc4a17d456851a457c520ef674275d469569160f57924b9ee7e345"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-token-value.json
+ lotto_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-val-addr.json
+ buy_validator_addr='{"fields":[{"fields":[{"bytes":"7dfb757ecbd0d7a14a42622f0d9d3f305dcd381de19c5299e8262978"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-value.json
+ buy_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/ticket-policy.hash
++ jq -r .bytes
+ ticket_mph=32350c5781b4fa6649e3bf09e18fb9309b2fdc2ba58528fad93910db
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ cat /home/lawrence/.local/keys/devnet/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
++ cat /home/lawrence/.local/keys/devnet/03.pkh
+ sponsor_pkh=84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268
+ echo 'starting lotto open'
starting lotto open
+ echo 'Script: '
Script: 
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 42 --payment-verification-key-file /home/lawrence/.local/keys/devnet/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 0c3ce05e4089d3992e78c15071465ccdfcd91dd158394503b3b638bf2af6050b#0
++ tr -d '\n'
+ admin_utxo_in=0c3ce05e4089d3992e78c15071465ccdfcd91dd158394503b3b638bf2af6050b#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wzutcjsh63tg2xj903fqaan5yaw5d9tfzc840yjtnmn7x3gzpqvuj --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=0c3ce05e4089d3992e78c15071465ccdfcd91dd158394503b3b638bf2af6050b#1
+ '[' devnet == devnet ']'
+ cp /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
++ jq -r '.fields[2].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jackpot=10000000
++ jq -r '.fields[3].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ seq_num=0
++ jq -r '.fields[4].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ treasury=0
+ [[ 10000000 -gt 0 ]]
+ new_jackpot=20000000
+ new_treasury=0
+ new_seq_num=1
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c '
  .fields[0].fields[0].bytes    |= "4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819"
| .fields[0].fields[1].bytes    |= "84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268"
| .fields[0].fields[2]          |= {"fields":[{"fields":[{"bytes":"b8bc4a17d456851a457c520ef674275d469569160f57924b9ee7e345"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}
| .fields[0].fields[3]          |= {"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e"},"v":{"int":1}}]}}]}
| .fields[0].fields[4]          |= {"fields":[{"fields":[{"bytes":"7dfb757ecbd0d7a14a42622f0d9d3f305dcd381de19c5299e8262978"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}
| .fields[0].fields[5]          |= {"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7"},"v":{"int":1}}]}}]}
| .fields[0].fields[6].bytes    |= "32350c5781b4fa6649e3bf09e18fb9309b2fdc2ba58528fad93910db"
| .fields[0].fields[7].int      |= 2
| .fields[0].fields[8].int      |= 20000
| .fields[1].list               |= [{"fields":[{"bytes":"84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268"},{"list":[]}], "constructor": 0}]
| .fields[2].int                |= 20000000
| .fields[3].int                |= 1
| .fields[4].int                |= 0
| .fields[6].map                |= [{"k":{"bytes":"84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268"},"v":{"int":0}}] 
| .fields[7].int                |= 1
| .fields[8].list               |= []'
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=20000000
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 42 --tx-in 0c3ce05e4089d3992e78c15071465ccdfcd91dd158394503b3b638bf2af6050b#0 --tx-in 0c3ce05e4089d3992e78c15071465ccdfcd91dd158394503b3b638bf2af6050b#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-open.json --tx-in-collateral 08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#2 --tx-out 'addr_test1wzutcjsh63tg2xj903fqaan5yaw5d9tfzc840yjtnmn7x3gzpqvuj+20000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body
Estimated transaction fee: Lovelace 686094
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body --testnet-magic 42 --signing-key-file /home/lawrence/.local/keys/devnet/01.skey --out-file /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx --testnet-magic 42
Transaction successfully submitted.

 please confirm before proceeding that you see the open tx on the blockchain
 
 
 [nix-shell:/home/lawrence/src/cardano-lottery]$ cardano-cli query utxo --address addr_test1wzutcjsh63tg2xj903fqaan5yaw5d9tfzc840yjtnmn7x3gzpqvuj --cardano-mode --testnet-magic 42
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
e975bd76f21d986d14ce78665283a088c3467ca41d99e3b6e2f9ce7416b892bc     1        20000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7 + TxOutDatumHash ScriptDataInAlonzoEra "34640eb34f0a1e61074d3866163b0ffd0f9026dadbc379690f076dc51b281a84"

 
 
+ '[' -z devnet ']'
+ ENV=devnet
+++ readlink -f ./startbuy-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/startbuy-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ export TESTNET_MAGIC=42
++ TESTNET_MAGIC=42
++ export ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#2
++ ADMIN_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#2
++ export PLAYER_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#4
++ PLAYER_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#4
++ export SPONSOR_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#6
++ SPONSOR_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#6
+ echo 'Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket'
Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ ls -al /home/lawrence/src/cardano-node/run/current/node-0/node.socket
srwxr-xr-x 1 lawrence lawrence 0 May  5 17:35 /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.hash
+ lotto_validator_hash='{"bytes":"b8bc4a17d456851a457c520ef674275d469569160f57924b9ee7e345"}'
+ buy_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --testnet-magic 42
+ lotto_validator_script_addr=addr_test1wzutcjsh63tg2xj903fqaan5yaw5d9tfzc840yjtnmn7x3gzpqvuj
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-validator.plutus --testnet-magic 42
+ buy_validator_script_addr=addr_test1wp7lkat7e0gd0g22gf3z7rva8uc9mnfcrhsec55eaqnzj7q6274ls
+ redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-startbuy.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-val-addr.json
+ lotto_validator_addr='{"fields":[{"fields":[{"bytes":"b8bc4a17d456851a457c520ef674275d469569160f57924b9ee7e345"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-token-value.json
+ lotto_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-val-addr.json
+ buy_validator_addr='{"fields":[{"fields":[{"bytes":"7dfb757ecbd0d7a14a42622f0d9d3f305dcd381de19c5299e8262978"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}'
++ jq -r .bytes
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-name.json
+ buy_token_name=ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-value.json
+ buy_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/ticket-policy.hash
++ jq -r .bytes
+ ticket_mph=32350c5781b4fa6649e3bf09e18fb9309b2fdc2ba58528fad93910db
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ cat /home/lawrence/.local/keys/devnet/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
+ echo 'starting lotto start buy'
starting lotto start buy
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 42 --payment-verification-key-file /home/lawrence/.local/keys/devnet/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo e975bd76f21d986d14ce78665283a088c3467ca41d99e3b6e2f9ce7416b892bc#0
++ tr -d '\n'
+ admin_utxo_in=e975bd76f21d986d14ce78665283a088c3467ca41d99e3b6e2f9ce7416b892bc#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wzutcjsh63tg2xj903fqaan5yaw5d9tfzc840yjtnmn7x3gzpqvuj --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=e975bd76f21d986d14ce78665283a088c3467ca41d99e3b6e2f9ce7416b892bc#1
+ '[' devnet == devnet ']'
+ cp /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=20000000
+ cp /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-datum-startbuy.datum /home/lawrence/src/cardano-lottery/work/buy-datum-out.json
++ /home/lawrence/.local/bin/cardano-cli transaction hash-script-data --script-data-file /home/lawrence/src/cardano-lottery/work/buy-datum-out.json
+ buy_datum_hash=d771d060b152d0b277de91d5dd5bc6eb193f451d5399a50f6945a7d819e586a4
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 42 --tx-in e975bd76f21d986d14ce78665283a088c3467ca41d99e3b6e2f9ce7416b892bc#0 --tx-in e975bd76f21d986d14ce78665283a088c3467ca41d99e3b6e2f9ce7416b892bc#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-startbuy.json --tx-in-collateral 08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#2 --tx-out 'addr_test1wzutcjsh63tg2xj903fqaan5yaw5d9tfzc840yjtnmn7x3gzpqvuj+20000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --tx-out 'addr_test1wp7lkat7e0gd0g22gf3z7rva8uc9mnfcrhsec55eaqnzj7q6274ls+2000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7' --tx-out-datum-hash d771d060b152d0b277de91d5dd5bc6eb193f451d5399a50f6945a7d819e586a4 --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body
Estimated transaction fee: Lovelace 536217
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body --testnet-magic 42 --signing-key-file /home/lawrence/.local/keys/devnet/01.skey --out-file /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx --testnet-magic 42
Transaction successfully submitted.

[nix-shell:/home/lawrence/src/cardano-lottery]$ cardano-cli query utxo --address addr_test1wzutcjsh63tg2xj903fqaan5yaw5d9tfzc840yjtnmn7x3gzpqvuj --cardano-mode --testnet-magic 42
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
b69a615772a25bcdfecb9aee114ed50ad74a6cd2ff53a463d3349c4a2f56fb50     1        20000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e + TxOutDatumHash ScriptDataInAlonzoEra "34640eb34f0a1e61074d3866163b0ffd0f9026dadbc379690f076dc51b281a84"


+ '[' -z devnet ']'
+ ENV=devnet
+++ readlink -f ./buy-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/buy-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ export TESTNET_MAGIC=42
++ TESTNET_MAGIC=42
++ export ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#2
++ ADMIN_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#2
++ export PLAYER_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#4
++ PLAYER_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#4
++ export SPONSOR_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#6
++ SPONSOR_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#6
+ echo 'Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket'
Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ ls -al /home/lawrence/src/cardano-node/run/current/node-0/node.socket
srwxr-xr-x 1 lawrence lawrence 0 May  5 17:35 /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
+ buy_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-validator.plutus
+ minting_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/ticket-policy.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --testnet-magic 42
+ lotto_validator_script_addr=addr_test1wzutcjsh63tg2xj903fqaan5yaw5d9tfzc840yjtnmn7x3gzpqvuj
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-validator.plutus --testnet-magic 42
+ buy_validator_script_addr=addr_test1wp7lkat7e0gd0g22gf3z7rva8uc9mnfcrhsec55eaqnzj7q6274ls
+ redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-buy-ticket.json
+ redeemer_mint_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-ticket-mint.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-val-addr.json
+ buy_validator_addr='{"fields":[{"fields":[{"bytes":"7dfb757ecbd0d7a14a42622f0d9d3f305dcd381de19c5299e8262978"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-value.json
+ buy_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/ticket-policy.hash
++ jq -r .bytes
+ ticket_mph=32350c5781b4fa6649e3bf09e18fb9309b2fdc2ba58528fad93910db
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ cat /home/lawrence/.local/keys/devnet/02.pkh
+ player_pkh=af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3
+ echo 'starting lotto buy'
starting lotto buy
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 42 --payment-verification-key-file /home/lawrence/.local/keys/devnet/02.vkey
+ player_addr=addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/player-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/player-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray player_utxo_valid_array
++ echo 08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#3
++ tr -d '\n'
+ player_utxo_in=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#3
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wp7lkat7e0gd0g22gf3z7rva8uc9mnfcrhsec55eaqnzj7q6274ls --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7") 
| .key' /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json
+ buy_validator_utxo_tx_in=b69a615772a25bcdfecb9aee114ed50ad74a6cd2ff53a463d3349c4a2f56fb50#2
+ '[' devnet == devnet ']'
+ cp /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ cp /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json
++ jq -r '.fields[0].fields[8].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ ticket_cost=20000
++ jq -r '.fields[3].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ seq_num=1
+ ticket_num=10
++ echo -n 10
++ xxd -ps
+ ticket_num_hex=3130
++ jq -r '.fields[0].int' /home/lawrence/src/cardano-lottery/work/buy-datum-in.json
+ ticket_total=0
++ jq -r '.fields[1].int' /home/lawrence/src/cardano-lottery/work/buy-datum-in.json
+ total_value=2000000
+ new_ticket_total=1
+ new_total_value=4000000
+ cat /home/lawrence/src/cardano-lottery/work/buy-datum-in.json
+ jq -c '
  .fields[0].int   |= 1
| .fields[1].int   |= 4000000'
+ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-ticket-mint.json
+ jq -c '
  .fields[0].constructor    |= 1
| .fields[1].bytes          |= "3130"'
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 42 --tx-in 08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#3 --tx-in b69a615772a25bcdfecb9aee114ed50ad74a6cd2ff53a463d3349c4a2f56fb50#2 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/buy-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-buy-ticket.json --mint-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/ticket-policy.plutus --mint-redeemer-file /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json --tx-in-collateral 08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#4 --tx-out 'addr_test1wp7lkat7e0gd0g22gf3z7rva8uc9mnfcrhsec55eaqnzj7q6274ls+4000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/buy-datum-out.json --tx-out 'addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju+2000000 + 1 32350c5781b4fa6649e3bf09e18fb9309b2fdc2ba58528fad93910db.3130' --change-address addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju --mint '1 32350c5781b4fa6649e3bf09e18fb9309b2fdc2ba58528fad93910db.3130' --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body
Estimated transaction fee: Lovelace 332037
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body --testnet-magic 42 --signing-key-file /home/lawrence/.local/keys/devnet/02.skey --out-file /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx --testnet-magic 42
Transaction successfully submitted.



[nix-shell:/home/lawrence/src/cardano-lottery]$ cardano-cli query utxo --address addr_test1wp7lkat7e0gd0g22gf3z7rva8uc9mnfcrhsec55eaqnzj7q6274ls --cardano-mode --testnet-magic 42
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
544520ba999311f5f34c886a4418952c410eaf3f1c11bf826a82d653afee9ae7     1        4000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7 + TxOutDatumHash ScriptDataInAlonzoEra "632de650457288ebb506cf1d7784fdb0344f4361e9666bb6eea840df819d1e7d"



+++ readlink -f ./transfertoken-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/transfertoken-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ export TESTNET_MAGIC=42
++ TESTNET_MAGIC=42
++ export ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#2
++ ADMIN_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#2
++ export PLAYER_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#4
++ PLAYER_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#4
++ export SPONSOR_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#6
++ SPONSOR_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#6
+ echo 'Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket'
Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ ls -al /home/lawrence/src/cardano-node/run/current/node-0/node.socket
srwxr-xr-x 1 lawrence lawrence 0 May  5 17:35 /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
+ buy_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --testnet-magic 42
+ lotto_validator_script_addr=addr_test1wzutcjsh63tg2xj903fqaan5yaw5d9tfzc840yjtnmn7x3gzpqvuj
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-validator.plutus --testnet-magic 42
+ buy_validator_script_addr=addr_test1wp7lkat7e0gd0g22gf3z7rva8uc9mnfcrhsec55eaqnzj7q6274ls
+ buy_redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-buy-transfertoken.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ cat /home/lawrence/.local/keys/devnet/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
+ echo 'starting transfer token'
starting transfer token
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 42 --payment-verification-key-file /home/lawrence/.local/keys/devnet/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo b69a615772a25bcdfecb9aee114ed50ad74a6cd2ff53a463d3349c4a2f56fb50#0
++ tr -d '\n'
+ admin_utxo_in=b69a615772a25bcdfecb9aee114ed50ad74a6cd2ff53a463d3349c4a2f56fb50#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wp7lkat7e0gd0g22gf3z7rva8uc9mnfcrhsec55eaqnzj7q6274ls --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7") 
| .key' /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json
+ buy_validator_utxo_tx_in=ad95026178255b3dff4a4cf866e54cb18689247a5906e440c1978d89a777cb65#1
+ '[' devnet == devnet ']'
+ cp /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json
++ jq -r '.fields[1].int ' /home/lawrence/src/cardano-lottery/work/buy-datum-in.json
+ buy_total_value=22000000
+ cp /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 42 --tx-in b69a615772a25bcdfecb9aee114ed50ad74a6cd2ff53a463d3349c4a2f56fb50#0 --tx-in ad95026178255b3dff4a4cf866e54cb18689247a5906e440c1978d89a777cb65#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/buy-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-buy-transfertoken.json --tx-in-collateral 08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#2 --tx-out 'addr_test1wzutcjsh63tg2xj903fqaan5yaw5d9tfzc840yjtnmn7x3gzpqvuj+22000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body
Estimated transaction fee: Lovelace 116503
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body --testnet-magic 42 --signing-key-file /home/lawrence/.local/keys/devnet/01.skey --out-file /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx --testnet-magic 42
Transaction successfully submitted.




[nix-shell:/home/lawrence/src/cardano-lottery]$ cardano-cli query utxo --address addr_test1wp7lkat7e0gd0g22gf3z7rva8uc9mnfcrhsec55eaqnzj7q6274ls --cardano-mode --testnet-magic 42
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
ad95026178255b3dff4a4cf866e54cb18689247a5906e440c1978d89a777cb65     1        22000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7 + TxOutDatumHash ScriptDataInAlonzoEra "6a2883e482735834b832b8154328342508548659115343418a955388bda9a438"

[nix-shell:/home/lawrence/src/cardano-lottery]$ cardano-cli query utxo --address addr_test1wp7lkat7e0gd0g22gf3z7rva8uc9mnfcrhsec55eaqnzj7q6274ls --cardano-mode --testnet-magic 42
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------

+ '[' -z devnet ']'
+ ENV=devnet
+++ readlink -f ./stopbuy-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/stopbuy-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ export TESTNET_MAGIC=42
++ TESTNET_MAGIC=42
++ export ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#2
++ ADMIN_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#2
++ export PLAYER_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#4
++ PLAYER_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#4
++ export SPONSOR_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#6
++ SPONSOR_COLLATERAL=08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#6
+ echo 'Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket'
Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ ls -al /home/lawrence/src/cardano-node/run/current/node-0/node.socket
srwxr-xr-x 1 lawrence lawrence 0 May  5 17:35 /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.hash
+ lotto_validator_hash='{"bytes":"b8bc4a17d456851a457c520ef674275d469569160f57924b9ee7e345"}'
+ buy_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --testnet-magic 42
+ lotto_validator_script_addr=addr_test1wzutcjsh63tg2xj903fqaan5yaw5d9tfzc840yjtnmn7x3gzpqvuj
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-validator.plutus --testnet-magic 42
+ buy_validator_script_addr=addr_test1wp7lkat7e0gd0g22gf3z7rva8uc9mnfcrhsec55eaqnzj7q6274ls
+ lotto_redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-stopbuy.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-token-value.json
+ lotto_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e"},"v":{"int":1}}]}}]}'
+ buy_redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-buy-transfertoken.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-value.json
+ buy_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ cat /home/lawrence/.local/keys/devnet/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
+ echo 'starting lotto stop buy'
starting lotto stop buy
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 42 --payment-verification-key-file /home/lawrence/.local/keys/devnet/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 7accfbb492f661de932c3c0e6daa391545cf81ca5e89497281880a6728481f0e#0
++ tr -d '\n'
+ admin_utxo_in=7accfbb492f661de932c3c0e6daa391545cf81ca5e89497281880a6728481f0e#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wzutcjsh63tg2xj903fqaan5yaw5d9tfzc840yjtnmn7x3gzpqvuj --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in_0=b69a615772a25bcdfecb9aee114ed50ad74a6cd2ff53a463d3349c4a2f56fb50#1
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in_1=7accfbb492f661de932c3c0e6daa391545cf81ca5e89497281880a6728481f0e#1
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7") 
| .value.value.lovelace' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ buy_total_value=22000000
+ '[' devnet == devnet ']'
+ cp /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ cp /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json
++ jq -r '.fields[2].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jackpot=20000000
++ jq -r '.fields[4].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ treasury=0
++ jq -r '.fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ fees=0
++ jq -r '.fields[0].fields[7].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ percentFees=2
+ new_jackpot=30780000
+ new_treasury=10780000
+ new_fees=440000
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c '
  .fields[2].int                |= 30780000
| .fields[4].int                |= 10780000
| .fields[5].int                |= 440000'
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=42000000
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 42 --tx-in 7accfbb492f661de932c3c0e6daa391545cf81ca5e89497281880a6728481f0e#0 --tx-in b69a615772a25bcdfecb9aee114ed50ad74a6cd2ff53a463d3349c4a2f56fb50#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-stopbuy.json --tx-in 7accfbb492f661de932c3c0e6daa391545cf81ca5e89497281880a6728481f0e#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-stopbuy.json --tx-in-collateral 08fd4e5e62df3d9a2439b5095e15d83a81b9ad8f8d55d4f4fe483c86756eec4d#2 --tx-out 'addr_test1wzutcjsh63tg2xj903fqaan5yaw5d9tfzc840yjtnmn7x3gzpqvuj+42000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.63ccb5f9d5b513f35693ca27db774839035772259c9b9c37c41343054d9da41e + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ec9925d73a23474fc288bee2b07b84f762179b338b2b0e9397c0cde1c20515f7' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body
Estimated transaction fee: Lovelace 1304443
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body --testnet-magic 42 --signing-key-file /home/lawrence/.local/keys/devnet/01.skey --out-file /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx --testnet-magic 42
Command failed: transaction submit  Error: Error while submitting tx: ShelleyTxValidationError ShelleyBasedEraAlonzo (ApplyTxError [UtxowFailure (WrappedShelleyEraFailure (UtxoFailure (ExUnitsTooBigUTxO (WrapExUnits {unWrapExUnits = ExUnits' {exUnitsMem' = 10000000, exUnitsSteps' = 10000000000}}) (WrapExUnits {unWrapExUnits = ExUnits' {exUnitsMem' = 15626298, exUnitsSteps' = 5586760844}}))))])

[nix-shell:~/src/cardano-lottery]$ cardano-cli query protocol-parameters --testnet-magic 42

...

    "maxTxExecutionUnits": {
        "memory": 10000000,
        "steps": 10000000000
    },

[nix-shell:/home/lawrence/src/cardano-lottery]$ cabal exec cardano-lottery-scripts -- ./tmp scripts
Writing scripts (fully applied) to: ./tmp
Writing script: ./tmp/cardano-lottery-test-1.flat (Size: 3.7kB, Cost: ExCPU 406194123, ExMemory 1091518)
Writing script: ./tmp/cardano-lottery-test-2.flat (Size: 15.4kB, Cost: ExCPU 3019993736, ExMemory 8148743)
Writing script: ./tmp/cardano-lottery-test-3.flat (Size: 15.2kB, Cost: ExCPU 2364486314, ExMemory 6416120)
Writing script: ./tmp/cardano-lottery-test-4.flat (Size: 5.6kB, Cost: ExCPU 915565065, ExMemory 2608478)
Writing script: ./tmp/cardano-lottery-test-5.flat (Size: 3.9kB, Cost: ExCPU 554201480, ExMemory 1408136)
Writing script: ./tmp/cardano-lottery-test-6.flat (Size: 5.7kB, Cost: ExCPU 940400050, ExMemory 2677320)
Writing script: ./tmp/cardano-lottery-test-7.flat (Size: 4.0kB, Cost: ExCPU 566110417, ExMemory 1435868)
Writing script: ./tmp/cardano-lottery-test-8.flat (Size: 5.8kB, Cost: ExCPU 1065342546, ExMemory 3028910)
Writing script: ./tmp/cardano-lottery-test-9.flat (Size: 4.1kB, Cost: ExCPU 629691016, ExMemory 1587730)
Writing script: ./tmp/cardano-lottery-test-10.flat (Size: 5.8kB, Cost: ExCPU 1088725279, ExMemory 3097532)
Writing script: ./tmp/cardano-lottery-test-11.flat (Size: 4.2kB, Cost: ExCPU 636199690, ExMemory 1602042)
Writing script: ./tmp/cardano-lottery-test-12.flat (Size: 5.7kB, Cost: ExCPU 987165516, ExMemory 2814564)
Writing script: ./tmp/cardano-lottery-test-13.flat (Size: 4.0kB, Cost: ExCPU 579127765, ExMemory 1464492)
Writing script: ./tmp/cardano-lottery-test-14.flat (Size: 6.0kB, Cost: ExCPU 1237050508, ExMemory 3517744)
Writing script: ./tmp/cardano-lottery-test-15.flat (Size: 4.3kB, Cost: ExCPU 706288963, ExMemory 1768216)
Writing script: ./tmp/cardano-lottery-test-16.flat (Size: 5.7kB, Cost: ExCPU 1033930982, ExMemory 2951808)
Writing script: ./tmp/cardano-lottery-test-17.flat (Size: 4.0kB, Cost: ExCPU 592145113, ExMemory 1493116)
Writing script: ./tmp/cardano-lottery-test-18.flat (Size: 5.7kB, Cost: ExCPU 1033930982, ExMemory 2951808)
Writing script: ./tmp/cardano-lottery-test-19.flat (Size: 4.0kB, Cost: ExCPU 592145113, ExMemory 1493116)
Writing script: ./tmp/cardano-lottery-test-20.flat (Size: 6.0kB, Cost: ExCPU 1283815974, ExMemory 3654988)
Writing script: ./tmp/cardano-lottery-test-21.flat (Size: 4.3kB, Cost: ExCPU 719306311, ExMemory 1796840)
Writing script: ./tmp/cardano-lottery-test-22.flat (Size: 5.7kB, Cost: ExCPU 1080696448, ExMemory 3089052)
Writing script: ./tmp/cardano-lottery-test-23.flat (Size: 4.0kB, Cost: ExCPU 605162461, ExMemory 1521740)
Writing script: ./tmp/cardano-lottery-test-24.flat (Size: 5.6kB, Cost: ExCPU 887489655, ExMemory 2516668)
Writing script: ./tmp/cardano-lottery-test-25.flat (Size: 3.9kB, Cost: ExCPU 545090942, ExMemory 1377536)
Writing script: ./tmp/cardano-lottery-test-26.flat (Size: 5.9kB, Cost: ExCPU 524878260, ExMemory 1412600)
Writing script: ./tmp/cardano-lottery-test-27.flat (Size: 15.6kB, Cost: ExCPU 2796428779, ExMemory 7806909)
Writing script: ./tmp/cardano-lottery-test-28.flat (Size: 15.6kB, Cost: ExCPU 2791232715, ExMemory 7791301)
Writing script: ./tmp/cardano-lottery-test-29.flat (Size: 15.4kB, Cost: ExCPU 2414734225, ExMemory 6619154)
Writing script: ./tmp/cardano-lottery-test-30.flat (Size: 15.5kB, Cost: ExCPU 3136871659, ExMemory 8647780)
Writing script: ./tmp/cardano-lottery-test-31.flat (Size: 15.7kB, Cost: ExCPU 3613221561, ExMemory 10220558)
Writing script: ./tmp/cardano-lottery-test-32.flat (Size: 15.7kB, Cost: ExCPU 2962464005, ExMemory 8132994)
Writing script: ./tmp/cardano-lottery-test-33.flat (Size: 15.4kB, Cost: ExCPU 2826694114, ExMemory 7768088)
Writing script: ./tmp/cardano-lottery-test-34.flat (Size: 15.3kB, Cost: ExCPU 2781466350, ExMemory 7640046)
Writing script: ./tmp/cardano-lottery-test-35.flat (Size: 15.4kB, Cost: ExCPU 2341189679, ExMemory 6417670)
Total Size: 287.7kB, Cost: ExCPU 50259437796, ExMemory 137971185


[nix-shell:~/src/cardano-lottery]$ cardano-cli query protocol-parameters --testnet-magic 42

...

    "maxTxExecutionUnits": {
        "memory": 16000000,
        "steps": 10000000000
    },



+++ readlink -f ./transfertoken-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/transfertoken-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ export TESTNET_MAGIC=42
++ TESTNET_MAGIC=42
++ export ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2
++ ADMIN_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2
++ export PLAYER_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4
++ PLAYER_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4
++ export SPONSOR_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#6
++ SPONSOR_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#6
+ echo 'Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket'
Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ ls -al /home/lawrence/src/cardano-node/run/current/node-0/node.socket
srwxr-xr-x 1 lawrence lawrence 0 May  5 22:39 /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
+ buy_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --testnet-magic 42
+ lotto_validator_script_addr=addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-validator.plutus --testnet-magic 42
+ buy_validator_script_addr=addr_test1wrahpnqj76ruamc955e4xy32qmt4ng7n80wktjw83ahdv4s84q9yz
+ buy_redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-buy-transfertoken.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ cat /home/lawrence/.local/keys/devnet/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
+ echo 'starting transfer token'
starting transfer token
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 42 --payment-verification-key-file /home/lawrence/.local/keys/devnet/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 5403f06a3e1da28cf1b46d1859dce68322afef696f1eafbcc1a7436f7dd8374b#0
++ tr -d '\n'
+ admin_utxo_in=5403f06a3e1da28cf1b46d1859dce68322afef696f1eafbcc1a7436f7dd8374b#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wrahpnqj76ruamc955e4xy32qmt4ng7n80wktjw83ahdv4s84q9yz --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85") 
| .key' /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json
+ buy_validator_utxo_tx_in=6b6fa944333e434087c3f9c6e4e0223e1d8ee463e0166f22bd8e95d0f9a0a216#1
+ '[' devnet == devnet ']'
+ cp /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json
++ jq -r '.fields[1].int ' /home/lawrence/src/cardano-lottery/work/buy-datum-in.json
+ buy_total_value=22000000
+ cp /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 42 --tx-in 5403f06a3e1da28cf1b46d1859dce68322afef696f1eafbcc1a7436f7dd8374b#0 --tx-in 6b6fa944333e434087c3f9c6e4e0223e1d8ee463e0166f22bd8e95d0f9a0a216#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/buy-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-buy-transfertoken.json --tx-in-collateral 6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2 --tx-out 'addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6+22000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body
Estimated transaction fee: Lovelace 116503
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body --testnet-magic 42 --signing-key-file /home/lawrence/.local/keys/devnet/01.skey --out-file /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx --testnet-magic 42
Transaction successfully submitted.


[nix-shell:~/src/cardano-lottery]$ cardano-cli query utxo --address addr_test1wrahpnqj76ruamc955e4xy32qmt4ng7n80wktjw83ahdv4s84q9yz --cardano-mode --testnet-magic 42
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------

[nix-shell:~/src/cardano-lottery]$ cardano-cli query utxo --address addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6 --cardano-mode --testnet-magic 42
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
5403f06a3e1da28cf1b46d1859dce68322afef696f1eafbcc1a7436f7dd8374b     1        20000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483 + TxOutDatumHash ScriptDataInAlonzoEra "0af815f66507448cd3df2246fef78326e09489e969dc03c70066b065969bc01a"
78b8d767d2f72f38e594a79efd5b888aff38dbe226b2ecc97fd8abd7bd734e99     1        22000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85 + TxOutDatumHash ScriptDataInAlonzoEra "0af815f66507448cd3df2246fef78326e09489e969dc03c70066b065969bc01a"


+ '[' -z devnet ']'
+ ENV=devnet
+++ readlink -f ./stopbuy-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/stopbuy-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ export TESTNET_MAGIC=42
++ TESTNET_MAGIC=42
++ export ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2
++ ADMIN_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2
++ export PLAYER_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4
++ PLAYER_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4
++ export SPONSOR_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#6
++ SPONSOR_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#6
+ echo 'Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket'
Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ ls -al /home/lawrence/src/cardano-node/run/current/node-0/node.socket
srwxr-xr-x 1 lawrence lawrence 0 May  5 22:39 /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.hash
+ lotto_validator_hash='{"bytes":"d43f81b787a81523989c34e6c41ad50c37176aa2adca15d7635ac4d8"}'
+ buy_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --testnet-magic 42
+ lotto_validator_script_addr=addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-validator.plutus --testnet-magic 42
+ buy_validator_script_addr=addr_test1wrahpnqj76ruamc955e4xy32qmt4ng7n80wktjw83ahdv4s84q9yz
+ lotto_redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-stopbuy.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-token-value.json
+ lotto_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483"},"v":{"int":1}}]}}]}'
+ buy_redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-buy-transfertoken.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-value.json
+ buy_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ cat /home/lawrence/.local/keys/devnet/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
+ echo 'starting lotto stop buy'
starting lotto stop buy
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 42 --payment-verification-key-file /home/lawrence/.local/keys/devnet/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 78b8d767d2f72f38e594a79efd5b888aff38dbe226b2ecc97fd8abd7bd734e99#0
++ tr -d '\n'
+ admin_utxo_in=78b8d767d2f72f38e594a79efd5b888aff38dbe226b2ecc97fd8abd7bd734e99#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6 --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in_0=5403f06a3e1da28cf1b46d1859dce68322afef696f1eafbcc1a7436f7dd8374b#1
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in_1=78b8d767d2f72f38e594a79efd5b888aff38dbe226b2ecc97fd8abd7bd734e99#1
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85") 
| .value.value.lovelace' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ buy_total_value=22000000
+ '[' devnet == devnet ']'
+ cp /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ cp /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json
++ jq -r '.fields[2].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jackpot=20000000
++ jq -r '.fields[4].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ treasury=0
++ jq -r '.fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ fees=0
++ jq -r '.fields[0].fields[7].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ percentFees=2
+ new_jackpot=30780000
+ new_treasury=10780000
+ new_fees=440000
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c '
  .fields[2].int                |= 30780000
| .fields[4].int                |= 10780000
| .fields[5].int                |= 440000'
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=42000000
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 42 --tx-in 78b8d767d2f72f38e594a79efd5b888aff38dbe226b2ecc97fd8abd7bd734e99#0 --tx-in 5403f06a3e1da28cf1b46d1859dce68322afef696f1eafbcc1a7436f7dd8374b#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-stopbuy.json --tx-in 78b8d767d2f72f38e594a79efd5b888aff38dbe226b2ecc97fd8abd7bd734e99#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-stopbuy.json --tx-in-collateral 6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2 --tx-out 'addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6+42000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body
Estimated transaction fee: Lovelace 1300390
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body --testnet-magic 42 --signing-key-file /home/lawrence/.local/keys/devnet/01.skey --out-file /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx --testnet-magic 42
Transaction successfully submitted.



[nix-shell:~/src/cardano-lottery]$ cardano-cli query utxo --address addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6 --cardano-mode --testnet-magic 42
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
62fef2a17cc9b366d531003e9efbe18d886828baa64897421bd152fd15841f4e     1        42000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483 + TxOutDatumHash ScriptDataInAlonzoEra "3789436993cb829e6f709b24b853805f87b89ca7b05c523591a0ef962c8e824a"


+ '[' -z devnet ']'
+ ENV=devnet
+++ readlink -f ./close-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/close-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ export TESTNET_MAGIC=42
++ TESTNET_MAGIC=42
++ export ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2
++ ADMIN_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2
++ export PLAYER_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4
++ PLAYER_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4
++ export SPONSOR_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#6
++ SPONSOR_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#6
+ echo 'Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket'
Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ ls -al /home/lawrence/src/cardano-node/run/current/node-0/node.socket
srwxr-xr-x 1 lawrence lawrence 0 May  5 22:39 /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --testnet-magic 42
+ lotto_validator_script_addr=addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
+ redeemer_file=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-close.json
++ cat /home/lawrence/.local/keys/devnet/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
+ echo 'starting lotto close'
starting lotto close
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 42 --payment-verification-key-file /home/lawrence/.local/keys/devnet/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 62fef2a17cc9b366d531003e9efbe18d886828baa64897421bd152fd15841f4e#0
++ tr -d '\n'
+ admin_utxo_in=62fef2a17cc9b366d531003e9efbe18d886828baa64897421bd152fd15841f4e#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6 --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=62fef2a17cc9b366d531003e9efbe18d886828baa64897421bd152fd15841f4e#1
+ '[' devnet == devnet ']'
+ cp /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c ' .fields[7].int  |= 2 '
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=42000000
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 42 --tx-in 62fef2a17cc9b366d531003e9efbe18d886828baa64897421bd152fd15841f4e#0 --tx-in 62fef2a17cc9b366d531003e9efbe18d886828baa64897421bd152fd15841f4e#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-close.json --tx-in-collateral 6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2 --tx-out 'addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6+42000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.body
Estimated transaction fee: Lovelace 557115
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.body --testnet-magic 42 --signing-key-file /home/lawrence/.local/keys/devnet/01.skey --out-file /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.tx --testnet-magic 42
Transaction successfully submitted.

+ '[' -z devnet ']'
+ ENV=devnet
+++ readlink -f ./draw-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/draw-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ export TESTNET_MAGIC=42
++ TESTNET_MAGIC=42
++ export ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2
++ ADMIN_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2
++ export PLAYER_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4
++ PLAYER_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4
++ export SPONSOR_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#6
++ SPONSOR_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#6
+ echo 'Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket'
Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ ls -al /home/lawrence/src/cardano-node/run/current/node-0/node.socket
srwxr-xr-x 1 lawrence lawrence 0 May  5 22:39 /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ /home/lawrence/.local/bin/cardano-cli transaction policyid --script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --testnet-magic 42
+ lotto_validator_script_addr=addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
+ redeemer_file=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-draw.json
++ cat /home/lawrence/.local/keys/devnet/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
+ echo 'starting lotto draw'
starting lotto draw
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 42 --payment-verification-key-file /home/lawrence/.local/keys/devnet/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo d07bf3a53db58814f1019f65c9bea7b6ec976b8f70d254aa5ed012a9711ae05a#0
++ tr -d '\n'
+ admin_utxo_in=d07bf3a53db58814f1019f65c9bea7b6ec976b8f70d254aa5ed012a9711ae05a#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6 --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=d07bf3a53db58814f1019f65c9bea7b6ec976b8f70d254aa5ed012a9711ae05a#1
+ cat /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ jq 'to_entries[] | select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483")'
++ cat /home/lawrence/src/cardano-lottery/work/close-utxo.json
++ jq '.key | split("#") | .[0]'
+ close_tx='"d07bf3a53db58814f1019f65c9bea7b6ec976b8f70d254aa5ed012a9711ae05a"'
+ '[' devnet == devnet ']'
+ cp /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ cat /home/lawrence/src/cardano-lottery/work/close-utxo.json
+ jq '.key
| split("#") 
| .[0] 
| explode 
| [.[1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63]] 
| map(.-48) 
| map(select(. < 10))
| map({"int":.})'
++ jq -r -c . /home/lawrence/src/cardano-lottery/work/win-nums.json
+ win_nums='[{"int":0},{"int":3},{"int":5},{"int":5},{"int":8},{"int":4},{"int":1},{"int":1},{"int":5},{"int":9},{"int":7},{"int":6},{"int":7},{"int":0},{"int":2},{"int":4},{"int":0},{"int":2},{"int":9},{"int":1},{"int":0}]'
+ echo 'winning numbers:'
winning numbers:
+ echo '[{"int":0},{"int":3},{"int":5},{"int":5},{"int":8},{"int":4},{"int":1},{"int":1},{"int":5},{"int":9},{"int":7},{"int":6},{"int":7},{"int":0},{"int":2},{"int":4},{"int":0},{"int":2},{"int":9},{"int":1},{"int":0}]'
[{"int":0},{"int":3},{"int":5},{"int":5},{"int":8},{"int":4},{"int":1},{"int":1},{"int":5},{"int":9},{"int":7},{"int":6},{"int":7},{"int":0},{"int":2},{"int":4},{"int":0},{"int":2},{"int":9},{"int":1},{"int":0}]
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c ' 
  .fields[7].int  |= 3
| .fields[8].list |= [{"int":0},{"int":3},{"int":5},{"int":5},{"int":8},{"int":4},{"int":1},{"int":1},{"int":5},{"int":9},{"int":7},{"int":6},{"int":7},{"int":0},{"int":2},{"int":4},{"int":0},{"int":2},{"int":9},{"int":1},{"int":0}]'
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=42000000
+ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-draw.json
+ jq -c '.fields[0].bytes |= "d07bf3a53db58814f1019f65c9bea7b6ec976b8f70d254aa5ed012a9711ae05a"'
+ echo 'build the transaction'
build the transaction
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 42 --tx-in d07bf3a53db58814f1019f65c9bea7b6ec976b8f70d254aa5ed012a9711ae05a#0 --tx-in d07bf3a53db58814f1019f65c9bea7b6ec976b8f70d254aa5ed012a9711ae05a#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/work/redeemer-lotto-draw.json --tx-in-collateral 6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2 --tx-out 'addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6+42000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.body
Estimated transaction fee: Lovelace 734830
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.body --testnet-magic 42 --signing-key-file /home/lawrence/.local/keys/devnet/01.skey --out-file /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.tx --testnet-magic 42
Transaction successfully submitted.

+ '[' -z devnet ']'
+ ENV=devnet
+++ readlink -f ./redeem-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/redeem-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ export TESTNET_MAGIC=42
++ TESTNET_MAGIC=42
++ export ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2
++ ADMIN_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2
++ export PLAYER_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4
++ PLAYER_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4
++ export SPONSOR_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#6
++ SPONSOR_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#6
+ echo 'Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket'
Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ ls -al /home/lawrence/src/cardano-node/run/current/node-0/node.socket
srwxr-xr-x 1 lawrence lawrence 0 May  5 22:39 /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/close-utxo.json /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeemer-lotto-draw.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/win-nums.json /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --testnet-magic 42
+ lotto_validator_script_addr=addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6
+ minting_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/ticket-policy.plutus
+ redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-redeem.json
+ redeemer_mint_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-ticket-burn.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/ticket-policy.hash
++ jq -r .bytes
+ ticket_mph=1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ cat /home/lawrence/.local/keys/devnet/02.pkh
+ player_pkh=af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3
+ echo 'starting lotto redeem'
starting lotto redeem
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6 --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=4ea70365c0c7e2a0a1d8af4eac40c5dda7ca8e9f87933fe0ac619641d2bc28a2#1
+ '[' devnet == devnet ']'
+ cp /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
++ jq -r '.fields[1]' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ winners='{
  "list": [
    {
      "fields": [
        {
          "bytes": "84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268"
        },
        {
          "list": []
        }
      ],
      "constructor": 0
    }
  ]
}'
++ jq -r '.fields[0].fields[9].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ difficulty=1
++ jq -r -c '.fields[8].list ' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
++ jq -c 'limit(1;.[])'
+ winning_numbers='{"int":0}'
++ echo '{"int":0}'
++ jq .int
++ tr -d '\n'
+ win_num=0
++ jq -r '.fields[0].fields[1].bytes' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ sponsor_pkh=84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268
++ jq -r '.fields[3].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ seq_num=1
+ ticket_num=10
++ echo -n 10
++ xxd -ps
+ ticket_num_hex=3130
++ jq -r -c '.fields[8].list ' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
++ jq -c '[limit(1;.[])]'
+ winning_numbers_array='[{"int":0}]'
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c '
.fields[1].list               |= [{"fields":[{"bytes":"84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268"},{"list":[]}], "constructor": 0}
                                 ,{"fields":[{"bytes":"af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3"},{"list":[{"int":0}]}], "constructor": 0}
                                 ]'
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=42000000
+ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-redeem.json
+ jq -c '
.fields[0].bytes          |= "3130"'
+ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-ticket-burn.json
+ jq -c '
  .fields[0].constructor    |= 0
| .fields[1].bytes          |= "3130"'
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 42 --payment-verification-key-file /home/lawrence/.local/keys/devnet/02.vkey
+ player_addr=addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/player-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/player-utxo.json
+ jq -r 'to_entries[] | {"txid":.key,"mph":.value.value} '
++ cat /home/lawrence/src/cardano-lottery/work/player-utxo-valid.out
++ jq -r 'select(.mph."1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba"."3130") | .txid'
+ tx_in_win_num=725fd7fb96840b63a1778adc01c37f60166b623cac9d61502c2e713a57a9b1a3#2
+ cat /home/lawrence/src/cardano-lottery/work/player-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray player_utxo_valid_array
++ echo 6b6fa944333e434087c3f9c6e4e0223e1d8ee463e0166f22bd8e95d0f9a0a216#0
++ tr -d '\n'
+ player_utxo_in=6b6fa944333e434087c3f9c6e4e0223e1d8ee463e0166f22bd8e95d0f9a0a216#0
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 42 --tx-in 6b6fa944333e434087c3f9c6e4e0223e1d8ee463e0166f22bd8e95d0f9a0a216#0 --tx-in 725fd7fb96840b63a1778adc01c37f60166b623cac9d61502c2e713a57a9b1a3#2 --tx-in 4ea70365c0c7e2a0a1d8af4eac40c5dda7ca8e9f87933fe0ac619641d2bc28a2#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/work/redeemer-lotto-redeem.json --tx-in-collateral 6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4 --tx-out 'addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6+42000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --tx-out 'addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju+2000000 + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3130' --change-address addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju --required-signer-hash af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.body
Estimated transaction fee: Lovelace 819538
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.body --testnet-magic 42 --signing-key-file /home/lawrence/.local/keys/devnet/02.skey --out-file /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.tx --testnet-magic 42
Transaction successfully submitted.



[nix-shell:~/src/cardano-lottery]$ cardano-cli query utxo --address addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju --cardano-mode --testnet-magic 42
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
156cbb13e84bbf25579de2fad7e71c9d1f8501347f5b3b500d907ec063a5f464     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3134 + TxOutDatumNone
388acdefceb954a5222c4f6581fecea21b4de576461020deb3bdbe2a01015442     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3133 + TxOutDatumNone
3c2e7e676ebd0b4f3f2efecc5732f28e9b45f26a8bab3eed5b55a7c559211327     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3131 + TxOutDatumNone
481277ca1c4eefdc9b19c9fa079fd6d07793cd7dd19be487da9094516f23b55b     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3135 + TxOutDatumNone
6524cb2d6452ebe75a94f0ea83bef07308bb41162ba8078accd99ae8050987eb     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3138 + TxOutDatumNone
6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4     4        10000000 lovelace + TxOutDatumNone
6b6fa944333e434087c3f9c6e4e0223e1d8ee463e0166f22bd8e95d0f9a0a216     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3139 + TxOutDatumNone
aa47432137486f27912a9c96bcf0c15e92968a6b704f3b1c1395ae4c5df13a3f     0        955858267 lovelace + TxOutDatumNone
aa47432137486f27912a9c96bcf0c15e92968a6b704f3b1c1395ae4c5df13a3f     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3130 + TxOutDatumNone
ba0ca52a24f844cc05a1e1449ee33ce64dde65f4b449152bdded7c543272e7e3     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3136 + TxOutDatumNone
cfce216a538630858279d0329c6e6ee5e86002104ff605122582148cfe6efd53     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3137 + TxOutDatumNone
fa66a907ee12b8df215dd4223ea38a3cb0cfea2d3c186b1604209d72814a18eb     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3132 + TxOutDatumNone


+ '[' -z devnet ']'
+ ENV=devnet
+++ readlink -f ./calc-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/calc-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ export TESTNET_MAGIC=42
++ TESTNET_MAGIC=42
++ export ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2
++ ADMIN_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2
++ export PLAYER_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4
++ PLAYER_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4
++ export SPONSOR_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#6
++ SPONSOR_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#6
+ echo 'Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket'
Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ ls -al /home/lawrence/src/cardano-node/run/current/node-0/node.socket
srwxr-xr-x 1 lawrence lawrence 0 May  5 22:39 /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/close-utxo.json /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo-valid.out /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/redeemer-lotto-draw.json /home/lawrence/src/cardano-lottery/work/redeemer-lotto-redeem.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-burn.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/win-nums.json /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ /home/lawrence/.local/bin/cardano-cli transaction policyid --script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --testnet-magic 42
+ lotto_validator_script_addr=addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
+ redeemer_file=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-calc.json
++ cat /home/lawrence/.local/keys/devnet/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
+ echo 'starting lotto calcadmin_utxo_in'
starting lotto calcadmin_utxo_in
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 42 --payment-verification-key-file /home/lawrence/.local/keys/devnet/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 4ea70365c0c7e2a0a1d8af4eac40c5dda7ca8e9f87933fe0ac619641d2bc28a2#0
++ tr -d '\n'
+ admin_utxo_in=4ea70365c0c7e2a0a1d8af4eac40c5dda7ca8e9f87933fe0ac619641d2bc28a2#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6 --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=aa47432137486f27912a9c96bcf0c15e92968a6b704f3b1c1395ae4c5df13a3f#1
+ '[' devnet == devnet ']'
+ cp /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
++ jq -r '.fields[1].list[0].fields[0].bytes' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ sponsor_pkh=84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268
++ jq -r '.fields[1].list[1].fields[0].bytes' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ player_pkh=af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3
++ jq -r '.fields[2].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jackpot=30780000
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/jackpot-split.json
++ jq .int
+ jackpot_split=50
+ sponsor_amount=15390000
+ player_amount=15390000
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c '
  .fields[7].int  |= 4
| .fields[6].map                |= [{"k":{"bytes":"af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3"},"v":{"int":15390000}}
                                 ,{"k":{"bytes":"84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268"},"v":{"int":15390000}}
                                 ]             
'
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=42000000
+ echo 'build the transaction'
build the transaction
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 42 --tx-in 4ea70365c0c7e2a0a1d8af4eac40c5dda7ca8e9f87933fe0ac619641d2bc28a2#0 --tx-in aa47432137486f27912a9c96bcf0c15e92968a6b704f3b1c1395ae4c5df13a3f#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-calc.json --tx-in-collateral 6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2 --tx-out 'addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6+42000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.body
Estimated transaction fee: Lovelace 695404
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.body --testnet-magic 42 --signing-key-file /home/lawrence/.local/keys/devnet/01.skey --out-file /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.tx --testnet-magic 42
Transaction successfully submitted.



+ '[' -z devnet ']'
+ ENV=devnet
+++ readlink -f ./payout-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/payout-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ export TESTNET_MAGIC=42
++ TESTNET_MAGIC=42
++ export ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2
++ ADMIN_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2
++ export PLAYER_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4
++ PLAYER_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4
++ export SPONSOR_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#6
++ SPONSOR_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#6
+ echo 'Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket'
Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ ls -al /home/lawrence/src/cardano-node/run/current/node-0/node.socket
srwxr-xr-x 1 lawrence lawrence 0 May  5 22:39 /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/close-utxo.json /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo-valid.out /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/redeemer-lotto-draw.json /home/lawrence/src/cardano-lottery/work/redeemer-lotto-redeem.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-burn.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/win-nums.json /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --testnet-magic 42
+ lotto_validator_script_addr=addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6
+ redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-payout.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-token-value.json
+ lotto_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
+ echo 'starting lotto payout'
starting lotto payout
+ '[' p == p ']'
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 42 --payment-verification-key-file /home/lawrence/.local/keys/devnet/02.vkey
+ user_addr=addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/player-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/player-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray player_utxo_valid_array
++ echo aa47432137486f27912a9c96bcf0c15e92968a6b704f3b1c1395ae4c5df13a3f#0
++ tr -d '\n'
+ user_utxo_in=aa47432137486f27912a9c96bcf0c15e92968a6b704f3b1c1395ae4c5df13a3f#0
+ user_collateral=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4
++ cat /home/lawrence/.local/keys/devnet/02.pkh
+ user_pkh=af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3
+ user_skey=/home/lawrence/.local/keys/devnet/02.skey
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6 --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=3c46cae3b90d5132de926bfe5e25834e6d2eabcbc7c6d4349d24a7f52bcb004e#1
+ '[' devnet == devnet ']'
+ cp /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
++ jq -r '.fields[6].map[0].k.bytes' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ pkh0=af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3
++ jq -r '.fields[6].map[1].k.bytes' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ pkh1=84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268
++ jq -r '.fields[2].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jackpot=30780000
+ '[' p == p ']'
++ cat /home/lawrence/.local/keys/devnet/02.pkh
+ '[' af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3 == af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3 ']'
++ jq '.fields[6].map[0].v.int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ win_amount=15390000
++ jq '.fields[6].map[1].v.int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ sponsor_amount=15390000
+ new_jackpot=15390000
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c '
          .fields[6].map                |= [{"k":{"bytes":"84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268"},"v":{"int":15390000}}]
        | .fields[2].int                |= 15390000 
        '
+ '[' p == s ']'
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=26610000
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 42 --tx-in aa47432137486f27912a9c96bcf0c15e92968a6b704f3b1c1395ae4c5df13a3f#0 --tx-in 3c46cae3b90d5132de926bfe5e25834e6d2eabcbc7c6d4349d24a7f52bcb004e#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-payout.json --tx-in-collateral 6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4 --tx-out 'addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6+26610000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --tx-out addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju+15390000 --change-address addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju --required-signer-hash af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.body
Estimated transaction fee: Lovelace 690083
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.body --testnet-magic 42 --signing-key-file /home/lawrence/.local/keys/devnet/02.skey --out-file /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.tx --testnet-magic 42
Transaction successfully submitted.


[nix-shell:~/src/cardano-lottery]$ cardano-cli query utxo --address addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju --cardano-mode --testnet-magic 42
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
156cbb13e84bbf25579de2fad7e71c9d1f8501347f5b3b500d907ec063a5f464     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3134 + TxOutDatumNone
388acdefceb954a5222c4f6581fecea21b4de576461020deb3bdbe2a01015442     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3133 + TxOutDatumNone
3c2e7e676ebd0b4f3f2efecc5732f28e9b45f26a8bab3eed5b55a7c559211327     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3131 + TxOutDatumNone
481277ca1c4eefdc9b19c9fa079fd6d07793cd7dd19be487da9094516f23b55b     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3135 + TxOutDatumNone
6524cb2d6452ebe75a94f0ea83bef07308bb41162ba8078accd99ae8050987eb     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3138 + TxOutDatumNone
6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4     4        10000000 lovelace + TxOutDatumNone
6b6fa944333e434087c3f9c6e4e0223e1d8ee463e0166f22bd8e95d0f9a0a216     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3139 + TxOutDatumNone
a4510fac8c88e79b46b932fc47e9b2450cedaea895872e27e2433366cb6a6f4e     0        955168184 lovelace + TxOutDatumNone
a4510fac8c88e79b46b932fc47e9b2450cedaea895872e27e2433366cb6a6f4e     2        15390000 lovelace + TxOutDatumNone
aa47432137486f27912a9c96bcf0c15e92968a6b704f3b1c1395ae4c5df13a3f     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3130 + TxOutDatumNone
ba0ca52a24f844cc05a1e1449ee33ce64dde65f4b449152bdded7c543272e7e3     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3136 + TxOutDatumNone
cfce216a538630858279d0329c6e6ee5e86002104ff605122582148cfe6efd53     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3137 + TxOutDatumNone
fa66a907ee12b8df215dd4223ea38a3cb0cfea2d3c186b1604209d72814a18eb     2        2000000 lovelace + 1 1d2e8eb5414d828c5d30f9afe19e5d4fffe41fac856315337930d5ba.3132 + TxOutDatumNone



+ '[' -z devnet ']'
+ ENV=devnet
+++ readlink -f ./end-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/end-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-node/run/current/node-0/node.socket
++ export TESTNET_MAGIC=42
++ TESTNET_MAGIC=42
++ export ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/devnet/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/devnet/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/devnet/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/devnet/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/devnet/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/devnet/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/devnet/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/devnet/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/devnet/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2
++ ADMIN_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2
++ export PLAYER_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4
++ PLAYER_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#4
++ export SPONSOR_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#6
++ SPONSOR_COLLATERAL=6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#6
+ echo 'Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket'
Socket path: /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ ls -al /home/lawrence/src/cardano-node/run/current/node-0/node.socket
srwxr-xr-x 1 lawrence lawrence 0 May  5 22:39 /home/lawrence/src/cardano-node/run/current/node-0/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/close-utxo.json /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo-valid.out /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/redeemer-lotto-draw.json /home/lawrence/src/cardano-lottery/work/redeemer-lotto-redeem.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-burn.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/win-nums.json /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --testnet-magic 42
+ lotto_validator_script_addr=addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6
+ redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-end.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ cat /home/lawrence/.local/keys/devnet/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
+ echo 'starting lotto end'
starting lotto end
+ echo 'Script: /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus'
Script: /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 42 --payment-verification-key-file /home/lawrence/.local/keys/devnet/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 3c46cae3b90d5132de926bfe5e25834e6d2eabcbc7c6d4349d24a7f52bcb004e#0
++ tr -d '\n'
+ admin_utxo_in=3c46cae3b90d5132de926bfe5e25834e6d2eabcbc7c6d4349d24a7f52bcb004e#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6 --testnet-magic 42 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=a4510fac8c88e79b46b932fc47e9b2450cedaea895872e27e2433366cb6a6f4e#1
+ '[' devnet == devnet ']'
+ cp /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c '
  .fields[1].list  |= [] 
| .fields[6].map   |= [] 
| .fields[7].int   |= 5 
| .fields[8].list  |= []'
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=26610000
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 42 --tx-in 3c46cae3b90d5132de926bfe5e25834e6d2eabcbc7c6d4349d24a7f52bcb004e#0 --tx-in a4510fac8c88e79b46b932fc47e9b2450cedaea895872e27e2433366cb6a6f4e#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/devnet/data/redeemer-lotto-end.json --tx-in-collateral 6ac3b15cd5b82fabbb5bbaa3bc25933f43ba50422cf2268ea522e563050529f4#2 --tx-out 'addr_test1wr2rlqdhs75p2gucns6wd3q665xrw9m252ku59whvddvfkqqhn4n6+26610000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.ad5b9a27f875fc97bb034a47780832d47f8c7f97385cf8783e610c63f839b483 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.6f3431cf2b10fca80d19e805253bbc32557e2cba9ef654ab138d13fbd98dae85' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/end-tx-alonzo.body
Estimated transaction fee: Lovelace 541553
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/end-tx-alonzo.body --testnet-magic 42 --signing-key-file /home/lawrence/.local/keys/devnet/01.skey --out-file /home/lawrence/src/cardano-lottery/work/end-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/end-tx-alonzo.tx --testnet-magic 42
Transaction successfully submitted.



### May 6, 2022
##################################################################################################
########################################## TESTNET ###############################################
##################################################################################################

LOTTO ADMIN
############
lawrence@lawrence-MacBookAir:~$ cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a     0        10000000 lovelace + TxOutDatumNone
9bf48a110b5f5620f90bf484dfadba3ccabe4ae2bc760d9f01a19dc447c27b8f     0        900000000 lovelace + TxOutDatumNone


PLAYER 
######
lawrence@lawrence-MacBookAir:~$ cardano-cli query utxo --address addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67     0        10000000 lovelace + TxOutDatumNone
d110d081ab71c282a96bd3b6051e606a9d54bb9a9cc56c9cafa87193cd76fd2a     0        100000000 lovelace + TxOutDatumNone
lawrence@lawrence-MacBookAir:~$ 


SPONSOR 
#######
lawrence@lawrence-MacBookAir:~$ cardano-cli query utxo --address addr_test1vzzrzjrckm7udfjm8jvfsw3t4w8zw989my85az49460sy6qmfy687 --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054     0        10000000 lovelace + TxOutDatumNone


+ '[' -z testnet ']'
+ ENV=testnet
+++ readlink -f ./init-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/init-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ export TESTNET_MAGIC=1097911063
++ TESTNET_MAGIC=1097911063
++ export ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ export PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ export SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
++ SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
+ echo 'Socket path: /home/lawrence/src/cardano-lottery/node.socket'
Socket path: /home/lawrence/src/cardano-lottery/node.socket
+ ls -al /home/lawrence/src/cardano-lottery/node.socket
srw------- 1 lawrence lawrence 0 May  6 08:15 /home/lawrence/src/cardano-lottery/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ rm -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/pparms.json
+ rm -f '/home/lawrence/src/cardano-lottery/work-backup/*'
+ ticket_cost=20000
+ initial_funding=10000000
+ fee_percentage=2
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
+ minting_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-thread-token-policy.plutus
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ lotto_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --testnet-magic 1097911063
+ lotto_validator_script_addr=addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp
+ redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-thread-token-mint.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993
++ cat /home/lawrence/.local/keys/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
++ cat /home/lawrence/.local/keys/03.pkh
+ sponsor_pkh=84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268
+ echo 'starting lotto init'
starting lotto init
+ echo 'Script: /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus'
Script: /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 1097911063 --payment-verification-key-file /home/lawrence/.local/keys/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 9bf48a110b5f5620f90bf484dfadba3ccabe4ae2bc760d9f01a19dc447c27b8f#0
++ tr -d '\n'
+ admin_utxo_in=9bf48a110b5f5620f90bf484dfadba3ccabe4ae2bc760d9f01a19dc447c27b8f#0
+ cp /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-datum-init.datum /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 1097911063 --tx-in 9bf48a110b5f5620f90bf484dfadba3ccabe4ae2bc760d9f01a19dc447c27b8f#0 --tx-in-collateral 4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0 --mint-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-thread-token-policy.plutus --mint-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-thread-token-mint.json --tx-out 'addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp+10000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --mint '1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993' --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body
Estimated transaction fee: Lovelace 423560
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body --testnet-magic 1097911063 --signing-key-file /home/lawrence/.local/keys/01.skey --out-file /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx --testnet-magic 1097911063
Transaction successfully submitted.

lawrence@lawrence-MacBookAir:~$ cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
7cea820d00591cfb7a794603e89e7c027066a4ad3c81a9790635ef7c7d90e5f4     1        10000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + TxOutDatumHash ScriptDataInAlonzoEra "c4c38849eaa2da43a872f10e3358219a44b649598736e5cb862b23bdbea929f6"


+ '[' -z testnet ']'
+ ENV=testnet
+++ readlink -f ./open-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/open-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ export TESTNET_MAGIC=1097911063
++ TESTNET_MAGIC=1097911063
++ export ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ export PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ export SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
++ SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
+ echo 'Socket path: /home/lawrence/src/cardano-lottery/node.socket'
Socket path: /home/lawrence/src/cardano-lottery/node.socket
+ ls -al /home/lawrence/src/cardano-lottery/node.socket
srw------- 1 lawrence lawrence 0 May  6 08:15 /home/lawrence/src/cardano-lottery/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work-backup
+ ticket_cost=20000
+ additional_funding=10000000
+ fee_percentage=2
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.hash
+ lotto_validator_hash='{"bytes":"82d97f70771a1dea9d02f28e2fb4146e2d984ed719e888daac7985bc"}'
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --testnet-magic 1097911063
+ lotto_validator_script_addr=addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp
+ redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-open.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-val-addr.json
+ lotto_validator_addr='{"fields":[{"fields":[{"bytes":"82d97f70771a1dea9d02f28e2fb4146e2d984ed719e888daac7985bc"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-value.json
+ lotto_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-val-addr.json
+ buy_validator_addr='{"fields":[{"fields":[{"bytes":"65d5f1a5e5e08899ffee236b741b867da1e480213c2a12476f0f9d98"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-value.json
+ buy_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/ticket-policy.hash
++ jq -r .bytes
+ ticket_mph=b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ cat /home/lawrence/.local/keys/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
++ cat /home/lawrence/.local/keys/03.pkh
+ sponsor_pkh=84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268
+ echo 'starting lotto open'
starting lotto open
+ echo 'Script: '
Script: 
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 1097911063 --payment-verification-key-file /home/lawrence/.local/keys/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 7cea820d00591cfb7a794603e89e7c027066a4ad3c81a9790635ef7c7d90e5f4#0
++ tr -d '\n'
+ admin_utxo_in=7cea820d00591cfb7a794603e89e7c027066a4ad3c81a9790635ef7c7d90e5f4#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=7cea820d00591cfb7a794603e89e7c027066a4ad3c81a9790635ef7c7d90e5f4#1
+ '[' testnet == devnet ']'
+ '[' testnet == testnet ']'
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/addresses/addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp/utxos
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   611  100   611    0     0   2166      0 --:--:-- --:--:-- --:--:--  2159
++ jq -r '.[0].data_hash' /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json
+ datum_hash=c4c38849eaa2da43a872f10e3358219a44b649598736e5cb862b23bdbea929f6
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/scripts/datum/c4c38849eaa2da43a872f10e3358219a44b649598736e5cb862b23bdbea929f6
+ jq -c .json_value
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1308  100  1308    0     0   4791      0 --:--:-- --:--:-- --:--:--  4791
++ jq -r '.fields[2].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jackpot=10000000
++ jq -r '.fields[3].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ seq_num=0
++ jq -r '.fields[4].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ treasury=0
+ [[ 10000000 -gt 0 ]]
+ new_jackpot=20000000
+ new_treasury=0
+ new_seq_num=1
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c '
  .fields[0].fields[0].bytes    |= "4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819"
| .fields[0].fields[1].bytes    |= "84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268"
| .fields[0].fields[2]          |= {"fields":[{"fields":[{"bytes":"82d97f70771a1dea9d02f28e2fb4146e2d984ed719e888daac7985bc"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}
| .fields[0].fields[3]          |= {"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6"},"v":{"int":1}}]}}]}
| .fields[0].fields[4]          |= {"fields":[{"fields":[{"bytes":"65d5f1a5e5e08899ffee236b741b867da1e480213c2a12476f0f9d98"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}
| .fields[0].fields[5]          |= {"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993"},"v":{"int":1}}]}}]}
| .fields[0].fields[6].bytes    |= "b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0"
| .fields[0].fields[7].int      |= 2
| .fields[0].fields[8].int      |= 20000
| .fields[1].list               |= [{"fields":[{"bytes":"84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268"},{"list":[]}], "constructor": 0}]
| .fields[2].int                |= 20000000
| .fields[3].int                |= 1
| .fields[4].int                |= 0
| .fields[6].map                |= [{"k":{"bytes":"84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268"},"v":{"int":0}}] 
| .fields[7].int                |= 1
| .fields[8].list               |= []'
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=20000000
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 1097911063 --tx-in 7cea820d00591cfb7a794603e89e7c027066a4ad3c81a9790635ef7c7d90e5f4#0 --tx-in 7cea820d00591cfb7a794603e89e7c027066a4ad3c81a9790635ef7c7d90e5f4#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-open.json --tx-in-collateral 4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0 --tx-out 'addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp+20000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body
Estimated transaction fee: Lovelace 1508295
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body --testnet-magic 1097911063 --signing-key-file /home/lawrence/.local/keys/01.skey --out-file /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx --testnet-magic 1097911063
Transaction successfully submitted.

lawrence@lawrence-MacBookAir:~$ cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
fdb2d8f0a689d73996a92569b0ff8c51544e8bad44234ce12cebddee055f7ca1     1        20000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + TxOutDatumHash ScriptDataInAlonzoEra "aa5b57ef8631a1d77def0455c7c738c2bef87dd72ca6f73001b1e1c9bb18c28f"


+ '[' -z testnet ']'
+ ENV=testnet
+++ readlink -f ./startbuy-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/startbuy-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ export TESTNET_MAGIC=1097911063
++ TESTNET_MAGIC=1097911063
++ export ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ export PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ export SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
++ SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
+ echo 'Socket path: /home/lawrence/src/cardano-lottery/node.socket'
Socket path: /home/lawrence/src/cardano-lottery/node.socket
+ ls -al /home/lawrence/src/cardano-lottery/node.socket
srw------- 1 lawrence lawrence 0 May  6 08:15 /home/lawrence/src/cardano-lottery/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.hash
+ lotto_validator_hash='{"bytes":"82d97f70771a1dea9d02f28e2fb4146e2d984ed719e888daac7985bc"}'
+ buy_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --testnet-magic 1097911063
+ lotto_validator_script_addr=addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-validator.plutus --testnet-magic 1097911063
+ buy_validator_script_addr=addr_test1wpjatud9uhsg3x0lac3kkaqmse76reyqyy7z5yj8du8emxq4v39yy
+ redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-startbuy.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-val-addr.json
+ lotto_validator_addr='{"fields":[{"fields":[{"bytes":"82d97f70771a1dea9d02f28e2fb4146e2d984ed719e888daac7985bc"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-value.json
+ lotto_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-val-addr.json
+ buy_validator_addr='{"fields":[{"fields":[{"bytes":"65d5f1a5e5e08899ffee236b741b867da1e480213c2a12476f0f9d98"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-value.json
+ buy_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/ticket-policy.hash
++ jq -r .bytes
+ ticket_mph=b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ cat /home/lawrence/.local/keys/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
+ echo 'starting lotto start buy'
starting lotto start buy
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 1097911063 --payment-verification-key-file /home/lawrence/.local/keys/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo fdb2d8f0a689d73996a92569b0ff8c51544e8bad44234ce12cebddee055f7ca1#0
++ tr -d '\n'
+ admin_utxo_in=fdb2d8f0a689d73996a92569b0ff8c51544e8bad44234ce12cebddee055f7ca1#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=fdb2d8f0a689d73996a92569b0ff8c51544e8bad44234ce12cebddee055f7ca1#1
+ '[' testnet == devnet ']'
+ '[' testnet == testnet ']'
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/addresses/addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp/utxos
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   611  100   611    0     0   3818      0 --:--:-- --:--:-- --:--:--  3818
++ jq -r '.[0].data_hash' /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json
+ datum_hash=aa5b57ef8631a1d77def0455c7c738c2bef87dd72ca6f73001b1e1c9bb18c28f
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/scripts/datum/aa5b57ef8631a1d77def0455c7c738c2bef87dd72ca6f73001b1e1c9bb18c28f
+ jq -c .json_value
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1308  100  1308    0     0   4671      0 --:--:-- --:--:-- --:--:--  4654
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=20000000
+ cp /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-datum-startbuy.datum /home/lawrence/src/cardano-lottery/work/buy-datum-out.json
++ /home/lawrence/.local/bin/cardano-cli transaction hash-script-data --script-data-file /home/lawrence/src/cardano-lottery/work/buy-datum-out.json
+ buy_datum_hash=d771d060b152d0b277de91d5dd5bc6eb193f451d5399a50f6945a7d819e586a4
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 1097911063 --tx-in fdb2d8f0a689d73996a92569b0ff8c51544e8bad44234ce12cebddee055f7ca1#0 --tx-in fdb2d8f0a689d73996a92569b0ff8c51544e8bad44234ce12cebddee055f7ca1#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-startbuy.json --tx-in-collateral 4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0 --tx-out 'addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp+20000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --tx-out 'addr_test1wpjatud9uhsg3x0lac3kkaqmse76reyqyy7z5yj8du8emxq4v39yy+2000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993' --tx-out-datum-hash d771d060b152d0b277de91d5dd5bc6eb193f451d5399a50f6945a7d819e586a4 --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body
Estimated transaction fee: Lovelace 1345482
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body --testnet-magic 1097911063 --signing-key-file /home/lawrence/.local/keys/01.skey --out-file /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx --testnet-magic 1097911063
Transaction successfully submitted.

lawrence@lawrence-MacBookAir:~$ cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
81649e373df2459f6ad4723875c58247a9fe141d9b4e848bb8bb84345663af7d     1        20000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + TxOutDatumHash ScriptDataInAlonzoEra "aa5b57ef8631a1d77def0455c7c738c2bef87dd72ca6f73001b1e1c9bb18c28f"


lawrence@lawrence-MacBookAir:~$ cardano-cli query utxo --address addr_test1wpjatud9uhsg3x0lac3kkaqmse76reyqyy7z5yj8du8emxq4v39yy --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
81649e373df2459f6ad4723875c58247a9fe141d9b4e848bb8bb84345663af7d     2        2000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993 + TxOutDatumHash ScriptDataInAlonzoEra "d771d060b152d0b277de91d5dd5bc6eb193f451d5399a50f6945a7d819e586a4"


+ '[' -z testnet ']'
+ ENV=testnet
+++ readlink -f ./buy-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/buy-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ export TESTNET_MAGIC=1097911063
++ TESTNET_MAGIC=1097911063
++ export ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ export PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ export SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
++ SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
+ echo 'Socket path: /home/lawrence/src/cardano-lottery/node.socket'
Socket path: /home/lawrence/src/cardano-lottery/node.socket
+ ls -al /home/lawrence/src/cardano-lottery/node.socket
srw------- 1 lawrence lawrence 0 May  6 08:15 /home/lawrence/src/cardano-lottery/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-utxo-in.json /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/t.sh /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
+ buy_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-validator.plutus
+ minting_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/ticket-policy.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --testnet-magic 1097911063
+ lotto_validator_script_addr=addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-validator.plutus --testnet-magic 1097911063
+ buy_validator_script_addr=addr_test1wpjatud9uhsg3x0lac3kkaqmse76reyqyy7z5yj8du8emxq4v39yy
+ redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-buy-ticket.json
+ redeemer_mint_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-ticket-mint.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-val-addr.json
+ buy_validator_addr='{"fields":[{"fields":[{"bytes":"65d5f1a5e5e08899ffee236b741b867da1e480213c2a12476f0f9d98"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-value.json
+ buy_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/ticket-policy.hash
++ jq -r .bytes
+ ticket_mph=b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ cat /home/lawrence/.local/keys/02.pkh
+ player_pkh=af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3
+ echo 'starting lotto buy'
starting lotto buy
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 1097911063 --payment-verification-key-file /home/lawrence/.local/keys/02.vkey
+ player_addr=addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/player-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/player-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray player_utxo_valid_array
++ echo 503ea529e37a6182da3901a99b9bd5e7975b6c85021cafaaaba35a192f89258e#0
++ tr -d '\n'
+ player_utxo_in=503ea529e37a6182da3901a99b9bd5e7975b6c85021cafaaaba35a192f89258e#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wpjatud9uhsg3x0lac3kkaqmse76reyqyy7z5yj8du8emxq4v39yy --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993") 
| .key' /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json
+ buy_validator_utxo_tx_in=503ea529e37a6182da3901a99b9bd5e7975b6c85021cafaaaba35a192f89258e#1
+ '[' testnet == devnet ']'
+ '[' testnet == testnet ']'
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/addresses/addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp/utxos
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   464  100   464    0     0   1506      0 --:--:-- --:--:-- --:--:--  1506
++ jq -r '.[0].data_hash' /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json
+ datum_hash=aa5b57ef8631a1d77def0455c7c738c2bef87dd72ca6f73001b1e1c9bb18c28f
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/scripts/datum/aa5b57ef8631a1d77def0455c7c738c2bef87dd72ca6f73001b1e1c9bb18c28f
+ jq -c .json_value
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1308  100  1308    0     0   2180      0 --:--:-- --:--:-- --:--:--  2176
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/addresses/addr_test1wpjatud9uhsg3x0lac3kkaqmse76reyqyy7z5yj8du8emxq4v39yy/utxos
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   463  100   463    0     0   1721      0 --:--:-- --:--:-- --:--:--  1721
++ jq -r '.[0].data_hash' /home/lawrence/src/cardano-lottery/work/buy-utxo-in.json
+ buy_datum_hash=a92fd8c49bd189a6f627ceaa96ed6e075526cea9992eebe68bc0e8675655c4cc
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/scripts/datum/a92fd8c49bd189a6f627ceaa96ed6e075526cea9992eebe68bc0e8675655c4cc
+ jq -c .json_value
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100    69  100    69    0     0    145      0 --:--:-- --:--:-- --:--:--   145
++ cat /home/lawrence/src/cardano-lottery/work/buy-datum-in.json
+ buy_datum_test='{"fields":[{"int":2},{"int":6000000}],"constructor":0}'
+ '[' '{"fields":[{"int":2},{"int":6000000}],"constructor":0}' == null ']'
++ jq -r '.fields[0].fields[8].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ ticket_cost=20000
++ jq -r '.fields[3].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ seq_num=1
+ ticket_num=10
++ echo -n 10
++ xxd -ps
+ ticket_num_hex=3130
++ jq -r '.fields[0].int' /home/lawrence/src/cardano-lottery/work/buy-datum-in.json
+ ticket_total=2
++ jq -r '.fields[1].int' /home/lawrence/src/cardano-lottery/work/buy-datum-in.json
+ total_value=6000000
+ new_ticket_total=3
+ new_total_value=8000000
+ cat /home/lawrence/src/cardano-lottery/work/buy-datum-in.json
+ jq -c '
  .fields[0].int   |= 3
| .fields[1].int   |= 8000000'
+ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-ticket-mint.json
+ jq -c '
  .fields[0].constructor    |= 1
| .fields[1].bytes          |= "3130"'
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 1097911063 --tx-in 503ea529e37a6182da3901a99b9bd5e7975b6c85021cafaaaba35a192f89258e#0 --tx-in 503ea529e37a6182da3901a99b9bd5e7975b6c85021cafaaaba35a192f89258e#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/buy-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-buy-ticket.json --mint-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/ticket-policy.plutus --mint-redeemer-file /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json --tx-in-collateral 53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0 --tx-out 'addr_test1wpjatud9uhsg3x0lac3kkaqmse76reyqyy7z5yj8du8emxq4v39yy+8000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/buy-datum-out.json --tx-out 'addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju+2000000 + 1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.3130' --change-address addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju --mint '1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.3130' --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body
Estimated transaction fee: Lovelace 852441
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body --testnet-magic 1097911063 --signing-key-file /home/lawrence/.local/keys/02.skey --out-file /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx --testnet-magic 1097911063
Transaction successfully submitted.

lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1wpjatud9uhsg3x0lac3kkaqmse76reyqyy7z5yj8du8emxq4v39yy --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
65b2f06529996c55e138378440ca88259e924a93ad931e654a3b7ba4921a2d0a     1        8000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993 + TxOutDatumHash ScriptDataInAlonzoEra "c40f6658aad4b9d005d04b4852e437212391e3ffca16856afc2de49a3600eb6c"

lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
503ea529e37a6182da3901a99b9bd5e7975b6c85021cafaaaba35a192f89258e     2        2000000 lovelace + 1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.313137 + TxOutDatumNone
53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67     0        10000000 lovelace + TxOutDatumNone
65b2f06529996c55e138378440ca88259e924a93ad931e654a3b7ba4921a2d0a     0        85453338 lovelace + TxOutDatumNone
65b2f06529996c55e138378440ca88259e924a93ad931e654a3b7ba4921a2d0a     2        2000000 lovelace + 1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.3130 + TxOutDatumNone
ae2df2fad828c606b9e495ff3ab5c98414b7235fa9e6d73c3078c383b5d4a81e     2        2000000 lovelace + 1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.313132 + TxOutDatumNone


awrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1wpjatud9uhsg3x0lac3kkaqmse76reyqyy7z5yj8du8emxq4v39yy --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
37474e7ef56a84d4bc4b40a11b89898c2dbc11698e797349bbf44f3f11fe6730     1        26000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993 + TxOutDatumHash ScriptDataInAlonzoEra "4674e3ec142c5bcb20c06a08e72fdee400adc356ee8afae40fe05307427a7453"


+++ readlink -f ./transfertoken-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/transfertoken-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ export TESTNET_MAGIC=1097911063
++ TESTNET_MAGIC=1097911063
++ export ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ export PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ export SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
++ SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
+ echo 'Socket path: /home/lawrence/src/cardano-lottery/node.socket'
Socket path: /home/lawrence/src/cardano-lottery/node.socket
+ ls -al /home/lawrence/src/cardano-lottery/node.socket
srw------- 1 lawrence lawrence 0 May  6 08:15 /home/lawrence/src/cardano-lottery/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-utxo-in.json /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/t.sh /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
+ buy_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --testnet-magic 1097911063
+ lotto_validator_script_addr=addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-validator.plutus --testnet-magic 1097911063
+ buy_validator_script_addr=addr_test1wpjatud9uhsg3x0lac3kkaqmse76reyqyy7z5yj8du8emxq4v39yy
+ buy_redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-buy-transfertoken.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ cat /home/lawrence/.local/keys/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
+ echo 'starting transfer token'
starting transfer token
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 1097911063 --payment-verification-key-file /home/lawrence/.local/keys/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 81649e373df2459f6ad4723875c58247a9fe141d9b4e848bb8bb84345663af7d#0
++ tr -d '\n'
+ admin_utxo_in=81649e373df2459f6ad4723875c58247a9fe141d9b4e848bb8bb84345663af7d#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wpjatud9uhsg3x0lac3kkaqmse76reyqyy7z5yj8du8emxq4v39yy --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993") 
| .key' /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json
+ buy_validator_utxo_tx_in=37474e7ef56a84d4bc4b40a11b89898c2dbc11698e797349bbf44f3f11fe6730#1
+ '[' testnet == devnet ']'
+ '[' testnet == testnet ']'
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/addresses/addr_test1wpjatud9uhsg3x0lac3kkaqmse76reyqyy7z5yj8du8emxq4v39yy/utxos
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   464  100   464    0     0   1645      0 --:--:-- --:--:-- --:--:--  1639
++ jq -r '.[0].data_hash' /home/lawrence/src/cardano-lottery/work/buy-utxo-in.json
+ buy_datum_hash=4674e3ec142c5bcb20c06a08e72fdee400adc356ee8afae40fe05307427a7453
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/scripts/datum/4674e3ec142c5bcb20c06a08e72fdee400adc356ee8afae40fe05307427a7453
+ jq -c .json_value
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100    71  100    71    0     0    169      0 --:--:-- --:--:-- --:--:--   169
++ jq -r '.fields[1].int ' /home/lawrence/src/cardano-lottery/work/buy-datum-in.json
+ buy_total_value=26000000
+ cp /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 1097911063 --tx-in 81649e373df2459f6ad4723875c58247a9fe141d9b4e848bb8bb84345663af7d#0 --tx-in 37474e7ef56a84d4bc4b40a11b89898c2dbc11698e797349bbf44f3f11fe6730#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/buy-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-buy-transfertoken.json --tx-in-collateral 4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0 --tx-out 'addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp+26000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body
Estimated transaction fee: Lovelace 523916
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body --testnet-magic 1097911063 --signing-key-file /home/lawrence/.local/keys/01.skey --out-file /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx --testnet-magic 1097911063
Transaction successfully submitted.



lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1wpjatud9uhsg3x0lac3kkaqmse76reyqyy7z5yj8du8emxq4v39yy --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
33ef197f75e6c1f4a8de175c709ccf38c064316a76c3f08e8efa06a4a150e4d5     1        26000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993 + TxOutDatumHash ScriptDataInAlonzoEra "aa5b57ef8631a1d77def0455c7c738c2bef87dd72ca6f73001b1e1c9bb18c28f"
81649e373df2459f6ad4723875c58247a9fe141d9b4e848bb8bb84345663af7d     1        20000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + TxOutDatumHash ScriptDataInAlonzoEra "aa5b57ef8631a1d77def0455c7c738c2bef87dd72ca6f73001b1e1c9bb18c28f"


+ '[' -z testnet ']'
+ ENV=testnet
+++ readlink -f ./stopbuy-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/stopbuy-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ export TESTNET_MAGIC=1097911063
++ TESTNET_MAGIC=1097911063
++ export ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ export PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ export SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
++ SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
+ echo 'Socket path: /home/lawrence/src/cardano-lottery/node.socket'
Socket path: /home/lawrence/src/cardano-lottery/node.socket
+ ls -al /home/lawrence/src/cardano-lottery/node.socket
srw------- 1 lawrence lawrence 0 May  6 08:15 /home/lawrence/src/cardano-lottery/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-utxo-in.json /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/t.sh /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.hash
+ lotto_validator_hash='{"bytes":"82d97f70771a1dea9d02f28e2fb4146e2d984ed719e888daac7985bc"}'
+ buy_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --testnet-magic 1097911063
+ lotto_validator_script_addr=addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-validator.plutus --testnet-magic 1097911063
+ buy_validator_script_addr=addr_test1wpjatud9uhsg3x0lac3kkaqmse76reyqyy7z5yj8du8emxq4v39yy
+ lotto_redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-stopbuy.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-value.json
+ lotto_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6"},"v":{"int":1}}]}}]}'
+ buy_redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-buy-transfertoken.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-value.json
+ buy_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ cat /home/lawrence/.local/keys/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
+ echo 'starting lotto stop buy'
starting lotto stop buy
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 1097911063 --payment-verification-key-file /home/lawrence/.local/keys/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 33ef197f75e6c1f4a8de175c709ccf38c064316a76c3f08e8efa06a4a150e4d5#0
++ tr -d '\n'
+ admin_utxo_in=33ef197f75e6c1f4a8de175c709ccf38c064316a76c3f08e8efa06a4a150e4d5#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in_0=81649e373df2459f6ad4723875c58247a9fe141d9b4e848bb8bb84345663af7d#1
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in_1=33ef197f75e6c1f4a8de175c709ccf38c064316a76c3f08e8efa06a4a150e4d5#1
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993") 
| .value.value.lovelace' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ buy_total_value=26000000
+ '[' testnet == devnet ']'
+ '[' testnet == testnet ']'
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/addresses/addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp/utxos
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   927  100   927    0     0   2742      0 --:--:-- --:--:-- --:--:--  2742
++ jq -r '.[0].data_hash' /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json
+ datum_hash_0=aa5b57ef8631a1d77def0455c7c738c2bef87dd72ca6f73001b1e1c9bb18c28f
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/scripts/datum/aa5b57ef8631a1d77def0455c7c738c2bef87dd72ca6f73001b1e1c9bb18c28f
+ jq -c .json_value
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1308  100  1308    0     0   2663      0 --:--:-- --:--:-- --:--:--  2658
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/addresses/addr_test1wpjatud9uhsg3x0lac3kkaqmse76reyqyy7z5yj8du8emxq4v39yy/utxos
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100     2  100     2    0     0      7      0 --:--:-- --:--:-- --:--:--     7
++ jq -r '.[0].data_hash' /home/lawrence/src/cardano-lottery/work/buy-utxo-in.json
+ buy_datum_hash=null
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/scripts/datum/null
+ jq -c .json_value
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100    95  100    95    0     0    335      0 --:--:-- --:--:-- --:--:--   334
++ jq -r '.fields[2].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jackpot=20000000
++ jq -r '.fields[4].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ treasury=0
++ jq -r '.fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ fees=0
++ jq -r '.fields[0].fields[7].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ percentFees=2
+ new_jackpot=32740000
+ new_treasury=12740000
+ new_fees=520000
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c '
  .fields[2].int                |= 32740000
| .fields[4].int                |= 12740000
| .fields[5].int                |= 520000'
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=46000000
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 1097911063 --tx-in 33ef197f75e6c1f4a8de175c709ccf38c064316a76c3f08e8efa06a4a150e4d5#0 --tx-in 81649e373df2459f6ad4723875c58247a9fe141d9b4e848bb8bb84345663af7d#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-stopbuy.json --tx-in 33ef197f75e6c1f4a8de175c709ccf38c064316a76c3f08e8efa06a4a150e4d5#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-stopbuy.json --tx-in-collateral 4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0 --tx-out 'addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp+46000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body
Estimated transaction fee: Lovelace 2129328
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body --testnet-magic 1097911063 --signing-key-file /home/lawrence/.local/keys/01.skey --out-file /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx --testnet-magic 1097911063
Transaction successfully submitted.




lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
93b234ac205976e1998ae882577a0816775c922356ccfa17cc9ab027b2b431e0     1        46000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + TxOutDatumHash ScriptDataInAlonzoEra "d1620756cea34811cb06595e71ed47e409610cf0053b6dc69ed8b871a31baa53"


+ '[' -z testnet ']'
+ ENV=testnet
+++ readlink -f ./close-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/close-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ export TESTNET_MAGIC=1097911063
++ TESTNET_MAGIC=1097911063
++ export ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ export PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ export SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
++ SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
+ echo 'Socket path: /home/lawrence/src/cardano-lottery/node.socket'
Socket path: /home/lawrence/src/cardano-lottery/node.socket
+ ls -al /home/lawrence/src/cardano-lottery/node.socket
srw------- 1 lawrence lawrence 0 May  6 08:15 /home/lawrence/src/cardano-lottery/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-utxo-in.json /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/t.sh /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --testnet-magic 1097911063
+ lotto_validator_script_addr=addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
+ redeemer_file=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-close.json
++ cat /home/lawrence/.local/keys/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
+ echo 'starting lotto close'
starting lotto close
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 1097911063 --payment-verification-key-file /home/lawrence/.local/keys/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 93b234ac205976e1998ae882577a0816775c922356ccfa17cc9ab027b2b431e0#0
++ tr -d '\n'
+ admin_utxo_in=93b234ac205976e1998ae882577a0816775c922356ccfa17cc9ab027b2b431e0#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=93b234ac205976e1998ae882577a0816775c922356ccfa17cc9ab027b2b431e0#1
+ '[' testnet == devnet ']'
+ '[' testnet == testnet ']'
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/addresses/addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp/utxos
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   611  100   611    0     0   2340      0 --:--:-- --:--:-- --:--:--  2350
++ jq -r '.[0].data_hash' /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json
+ datum_hash=d1620756cea34811cb06595e71ed47e409610cf0053b6dc69ed8b871a31baa53
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/scripts/datum/d1620756cea34811cb06595e71ed47e409610cf0053b6dc69ed8b871a31baa53
+ jq -c .json_value
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1320  100  1320    0     0   1996      0 --:--:-- --:--:-- --:--:--  1996
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c ' .fields[7].int  |= 2 '
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=46000000
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 1097911063 --tx-in 93b234ac205976e1998ae882577a0816775c922356ccfa17cc9ab027b2b431e0#0 --tx-in 93b234ac205976e1998ae882577a0816775c922356ccfa17cc9ab027b2b431e0#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-close.json --tx-in-collateral 4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0 --tx-out 'addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp+46000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.body
Estimated transaction fee: Lovelace 1380020
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.body --testnet-magic 1097911063 --signing-key-file /home/lawrence/.local/keys/01.skey --out-file /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.tx --testnet-magic 1097911063
Transaction successfully submitted.

lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
9e4cf7aa6050f9e0168a4fe4a96cb47df6d77d917980c63445c0686895d860fc     1        46000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + TxOutDatumHash ScriptDataInAlonzoEra "e377f2d2ed14a46047e93badf4b2b7da91553f50436de769b37623794ab04048"
lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ 


+ '[' -z testnet ']'
+ ENV=testnet
+++ readlink -f ./draw-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/draw-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ export TESTNET_MAGIC=1097911063
++ TESTNET_MAGIC=1097911063
++ export ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ export PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ export SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
++ SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
+ echo 'Socket path: /home/lawrence/src/cardano-lottery/node.socket'
Socket path: /home/lawrence/src/cardano-lottery/node.socket
+ ls -al /home/lawrence/src/cardano-lottery/node.socket
srw------- 1 lawrence lawrence 0 May  6 08:15 /home/lawrence/src/cardano-lottery/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-utxo-in.json /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/t.sh /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ /home/lawrence/.local/bin/cardano-cli transaction policyid --script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --testnet-magic 1097911063
+ lotto_validator_script_addr=addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
+ redeemer_file=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-draw.json
++ cat /home/lawrence/.local/keys/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
+ echo 'starting lotto draw'
starting lotto draw
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 1097911063 --payment-verification-key-file /home/lawrence/.local/keys/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 9e4cf7aa6050f9e0168a4fe4a96cb47df6d77d917980c63445c0686895d860fc#0
++ tr -d '\n'
+ admin_utxo_in=9e4cf7aa6050f9e0168a4fe4a96cb47df6d77d917980c63445c0686895d860fc#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=9e4cf7aa6050f9e0168a4fe4a96cb47df6d77d917980c63445c0686895d860fc#1
+ cat /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ jq 'to_entries[] | select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6")'
++ cat /home/lawrence/src/cardano-lottery/work/close-utxo.json
++ jq '.key | split("#") | .[0]'
+ close_tx='"9e4cf7aa6050f9e0168a4fe4a96cb47df6d77d917980c63445c0686895d860fc"'
+ '[' testnet == devnet ']'
+ '[' testnet == testnet ']'
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/addresses/addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp/utxos
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   611  100   611    0     0   3451      0 --:--:-- --:--:-- --:--:--  3451
++ jq -r '.[0].data_hash' /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json
+ datum_hash=e377f2d2ed14a46047e93badf4b2b7da91553f50436de769b37623794ab04048
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/scripts/datum/e377f2d2ed14a46047e93badf4b2b7da91553f50436de769b37623794ab04048
+ jq -c .json_value
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1320  100  1320    0     0   3324      0 --:--:-- --:--:-- --:--:--  3324
+ cat /home/lawrence/src/cardano-lottery/work/close-utxo.json
+ jq '.key
| split("#") 
| .[0] 
| explode 
| [.[1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63]] 
| map(.-48) 
| map(select(. < 10))
| map({"int":.})'
++ jq -r -c . /home/lawrence/src/cardano-lottery/work/win-nums.json
+ win_nums='[{"int":7},{"int":0},{"int":0},{"int":9},{"int":0},{"int":6},{"int":4},{"int":9},{"int":4},{"int":6},{"int":7},{"int":1},{"int":9},{"int":0},{"int":6},{"int":4},{"int":5},{"int":0},{"int":8},{"int":8},{"int":5},{"int":8},{"int":0}]'
+ echo 'winning numbers:'
winning numbers:
+ echo '[{"int":7},{"int":0},{"int":0},{"int":9},{"int":0},{"int":6},{"int":4},{"int":9},{"int":4},{"int":6},{"int":7},{"int":1},{"int":9},{"int":0},{"int":6},{"int":4},{"int":5},{"int":0},{"int":8},{"int":8},{"int":5},{"int":8},{"int":0}]'
[{"int":7},{"int":0},{"int":0},{"int":9},{"int":0},{"int":6},{"int":4},{"int":9},{"int":4},{"int":6},{"int":7},{"int":1},{"int":9},{"int":0},{"int":6},{"int":4},{"int":5},{"int":0},{"int":8},{"int":8},{"int":5},{"int":8},{"int":0}]
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c ' 
  .fields[7].int  |= 3
| .fields[8].list |= [{"int":7},{"int":0},{"int":0},{"int":9},{"int":0},{"int":6},{"int":4},{"int":9},{"int":4},{"int":6},{"int":7},{"int":1},{"int":9},{"int":0},{"int":6},{"int":4},{"int":5},{"int":0},{"int":8},{"int":8},{"int":5},{"int":8},{"int":0}]'
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=46000000
+ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-draw.json
+ jq -c '.fields[0].bytes |= "9e4cf7aa6050f9e0168a4fe4a96cb47df6d77d917980c63445c0686895d860fc"'
+ echo 'build the transaction'
build the transaction
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 1097911063 --tx-in 9e4cf7aa6050f9e0168a4fe4a96cb47df6d77d917980c63445c0686895d860fc#0 --tx-in 9e4cf7aa6050f9e0168a4fe4a96cb47df6d77d917980c63445c0686895d860fc#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/work/redeemer-lotto-draw.json --tx-in-collateral 4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0 --tx-out 'addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp+46000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.body
Estimated transaction fee: Lovelace 1570884
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.body --testnet-magic 1097911063 --signing-key-file /home/lawrence/.local/keys/01.skey --out-file /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.tx --testnet-magic 1097911063
Transaction successfully submitted.



lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
a8eb903716cd91167af37c2b1c8fa69f36de4e8a8bc3422ae035e414536bd0ad     1        46000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + TxOutDatumHash ScriptDataInAlonzoEra "e17b8627522f77cfdaf9c7148906a4be1f6c7a1d2b0bedfa090b2a9dc1dfe093"


+ '[' -z testnet ']'
+ ENV=testnet
+++ readlink -f ./redeem-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/redeem-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ export TESTNET_MAGIC=1097911063
++ TESTNET_MAGIC=1097911063
++ export ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ export PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ export SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
++ SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
+ echo 'Socket path: /home/lawrence/src/cardano-lottery/node.socket'
Socket path: /home/lawrence/src/cardano-lottery/node.socket
+ ls -al /home/lawrence/src/cardano-lottery/node.socket
srw------- 1 lawrence lawrence 0 May  6 08:15 /home/lawrence/src/cardano-lottery/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-utxo-in.json /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/close-utxo.json /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeemer-lotto-draw.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/t.sh /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/win-nums.json /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --testnet-magic 1097911063
+ lotto_validator_script_addr=addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp
+ minting_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/ticket-policy.plutus
+ redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-redeem.json
+ redeemer_mint_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-ticket-burn.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/ticket-policy.hash
++ jq -r .bytes
+ ticket_mph=b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ cat /home/lawrence/.local/keys/02.pkh
+ player_pkh=af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3
+ echo 'starting lotto redeem'
starting lotto redeem
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=a8eb903716cd91167af37c2b1c8fa69f36de4e8a8bc3422ae035e414536bd0ad#1
+ '[' testnet == devnet ']'
+ '[' testnet == testnet ']'
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/addresses/addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp/utxos
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   611  100   611    0     0   4184      0 --:--:-- --:--:-- --:--:--  4184
++ jq -r '.[0].data_hash' /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json
+ datum_hash=e17b8627522f77cfdaf9c7148906a4be1f6c7a1d2b0bedfa090b2a9dc1dfe093
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/scripts/datum/e17b8627522f77cfdaf9c7148906a4be1f6c7a1d2b0bedfa090b2a9dc1dfe093
+ jq -c .json_value
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1549  100  1549    0     0   4375      0 --:--:-- --:--:-- --:--:--  4363
++ jq -r '.fields[1]' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ winners='{
  "list": [
    {
      "fields": [
        {
          "bytes": "84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268"
        },
        {
          "list": []
        }
      ],
      "constructor": 0
    }
  ]
}'
++ jq -r '.fields[0].fields[9].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ difficulty=1
++ jq -r -c '.fields[8].list ' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
++ jq -c 'limit(1;.[])'
+ winning_numbers='{"int":7}'
++ echo '{"int":7}'
++ jq .int
++ tr -d '\n'
+ win_num=7
++ jq -r '.fields[0].fields[1].bytes' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ sponsor_pkh=84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268
++ jq -r '.fields[3].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ seq_num=1
+ ticket_num=17
++ echo -n 17
++ xxd -ps
+ ticket_num_hex=3137
++ jq -r -c '.fields[8].list ' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
++ jq -c '[limit(1;.[])]'
+ winning_numbers_array='[{"int":7}]'
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c '
.fields[1].list               |= [{"fields":[{"bytes":"84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268"},{"list":[]}], "constructor": 0}
                                 ,{"fields":[{"bytes":"af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3"},{"list":[{"int":7}]}], "constructor": 0}
                                 ]'
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=46000000
+ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-redeem.json
+ jq -c '
.fields[0].bytes          |= "3137"'
+ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-ticket-burn.json
+ jq -c '
  .fields[0].constructor    |= 0
| .fields[1].bytes          |= "3137"'
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 1097911063 --payment-verification-key-file /home/lawrence/.local/keys/02.vkey
+ player_addr=addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/player-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/player-utxo.json
+ jq -r 'to_entries[] | {"txid":.key,"mph":.value.value} '
++ cat /home/lawrence/src/cardano-lottery/work/player-utxo-valid.out
++ jq -r 'select(.mph."b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0"."3137") | .txid'
+ tx_in_win_num=558699c81de481ac517d1f7ee3d76a5cff3184f286d286b9a6255042b09fbf51#2
+ cat /home/lawrence/src/cardano-lottery/work/player-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray player_utxo_valid_array
++ echo 37474e7ef56a84d4bc4b40a11b89898c2dbc11698e797349bbf44f3f11fe6730#0
++ tr -d '\n'
+ player_utxo_in=37474e7ef56a84d4bc4b40a11b89898c2dbc11698e797349bbf44f3f11fe6730#0
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 1097911063 --tx-in 37474e7ef56a84d4bc4b40a11b89898c2dbc11698e797349bbf44f3f11fe6730#0 --tx-in 558699c81de481ac517d1f7ee3d76a5cff3184f286d286b9a6255042b09fbf51#2 --tx-in a8eb903716cd91167af37c2b1c8fa69f36de4e8a8bc3422ae035e414536bd0ad#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/work/redeemer-lotto-redeem.json --tx-in-collateral 53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0 --tx-out 'addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp+46000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --tx-out 'addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju+2000000 + 1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.3137' --change-address addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju --required-signer-hash af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.body
Estimated transaction fee: Lovelace 1669032
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.body --testnet-magic 1097911063 --signing-key-file /home/lawrence/.local/keys/02.skey --out-file /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.tx --testnet-magic 1097911063
Transaction successfully submitted.


lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
e5c7a5852127b170a01848f075efe13122177deabf5d204e47beb252314e2c63     1        46000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + TxOutDatumHash ScriptDataInAlonzoEra "59eb880dcf009cafe3dfe3120d96cbd7414b5983044d00e0098a39cf225a5321"



+ '[' -z testnet ']'
+ ENV=testnet
+++ readlink -f ./calc-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/calc-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ export TESTNET_MAGIC=1097911063
++ TESTNET_MAGIC=1097911063
++ export ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ export PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ export SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
++ SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
+ echo 'Socket path: /home/lawrence/src/cardano-lottery/node.socket'
Socket path: /home/lawrence/src/cardano-lottery/node.socket
+ ls -al /home/lawrence/src/cardano-lottery/node.socket
srw------- 1 lawrence lawrence 0 May  6 08:15 /home/lawrence/src/cardano-lottery/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-utxo-in.json /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/close-utxo.json /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo-valid.out /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/redeemer-lotto-draw.json /home/lawrence/src/cardano-lottery/work/redeemer-lotto-redeem.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-burn.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/t.sh /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/win-nums.json /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ /home/lawrence/.local/bin/cardano-cli transaction policyid --script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --testnet-magic 1097911063
+ lotto_validator_script_addr=addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
+ redeemer_file=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-calc.json
++ cat /home/lawrence/.local/keys/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
+ echo 'starting lotto calcadmin_utxo_in'
starting lotto calcadmin_utxo_in
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 1097911063 --payment-verification-key-file /home/lawrence/.local/keys/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo a8eb903716cd91167af37c2b1c8fa69f36de4e8a8bc3422ae035e414536bd0ad#0
++ tr -d '\n'
+ admin_utxo_in=a8eb903716cd91167af37c2b1c8fa69f36de4e8a8bc3422ae035e414536bd0ad#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=e5c7a5852127b170a01848f075efe13122177deabf5d204e47beb252314e2c63#1
+ '[' testnet == devnet ']'
+ '[' testnet == testnet ']'
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/addresses/addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp/utxos
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   611  100   611    0     0   2159      0 --:--:-- --:--:-- --:--:--  2159
++ jq -r '.[0].data_hash' /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json
+ datum_hash=59eb880dcf009cafe3dfe3120d96cbd7414b5983044d00e0098a39cf225a5321
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/scripts/datum/59eb880dcf009cafe3dfe3120d96cbd7414b5983044d00e0098a39cf225a5321
+ jq -c .json_value
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1668  100  1668    0     0   3915      0 --:--:-- --:--:-- --:--:--  3906
++ jq -r '.fields[1].list[0].fields[0].bytes' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ sponsor_pkh=84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268
++ jq -r '.fields[1].list[1].fields[0].bytes' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ player_pkh=af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3
++ jq -r '.fields[2].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jackpot=32740000
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/jackpot-split.json
++ jq .int
+ jackpot_split=50
+ sponsor_amount=16370000
+ player_amount=16370000
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c '
  .fields[7].int  |= 4
| .fields[6].map                |= [{"k":{"bytes":"af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3"},"v":{"int":16370000}}
                                 ,{"k":{"bytes":"84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268"},"v":{"int":16370000}}
                                 ]             
'
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=46000000
+ echo 'build the transaction'
build the transaction
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 1097911063 --tx-in a8eb903716cd91167af37c2b1c8fa69f36de4e8a8bc3422ae035e414536bd0ad#0 --tx-in e5c7a5852127b170a01848f075efe13122177deabf5d204e47beb252314e2c63#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-calc.json --tx-in-collateral 4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0 --tx-out 'addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp+46000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.body
Estimated transaction fee: Lovelace 1534729
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.body --testnet-magic 1097911063 --signing-key-file /home/lawrence/.local/keys/01.skey --out-file /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.tx --testnet-magic 1097911063
Transaction successfully submitted.


lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
dfb156a63cd09dadcdc05079785da5aae127755fdefca67d9f7007608d58587f     1        46000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + TxOutDatumHash ScriptDataInAlonzoEra "923ad2150e1c601b0e96d0d8f35a1e239a55d6876cd37c48554eba4ea149df7b"


+ '[' -z testnet ']'
+ ENV=testnet
+++ readlink -f ./payout-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/payout-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ export TESTNET_MAGIC=1097911063
++ TESTNET_MAGIC=1097911063
++ export ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ export PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ export SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
++ SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
+ echo 'Socket path: /home/lawrence/src/cardano-lottery/node.socket'
Socket path: /home/lawrence/src/cardano-lottery/node.socket
+ ls -al /home/lawrence/src/cardano-lottery/node.socket
srw------- 1 lawrence lawrence 0 May  6 08:15 /home/lawrence/src/cardano-lottery/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-utxo-in.json /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/close-utxo.json /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo-valid.out /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/redeemer-lotto-draw.json /home/lawrence/src/cardano-lottery/work/redeemer-lotto-redeem.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-burn.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/t.sh /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/win-nums.json /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --testnet-magic 1097911063
+ lotto_validator_script_addr=addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp
+ redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-payout.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-value.json
+ lotto_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
+ echo 'starting lotto payout'
starting lotto payout
+ '[' p == p ']'
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 1097911063 --payment-verification-key-file /home/lawrence/.local/keys/02.vkey
+ user_addr=addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/player-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/player-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray player_utxo_valid_array
++ echo e5c7a5852127b170a01848f075efe13122177deabf5d204e47beb252314e2c63#0
++ tr -d '\n'
+ user_utxo_in=e5c7a5852127b170a01848f075efe13122177deabf5d204e47beb252314e2c63#0
+ user_collateral=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ cat /home/lawrence/.local/keys/02.pkh
+ user_pkh=af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3
+ user_skey=/home/lawrence/.local/keys/02.skey
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=dfb156a63cd09dadcdc05079785da5aae127755fdefca67d9f7007608d58587f#1
+ '[' testnet == devnet ']'
+ '[' testnet == testnet ']'
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/addresses/addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp/utxos
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   611  100   611    0     0   3215      0 --:--:-- --:--:-- --:--:--  3215
++ jq -r '.[0].data_hash' /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json
+ datum_hash=923ad2150e1c601b0e96d0d8f35a1e239a55d6876cd37c48554eba4ea149df7b
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/scripts/datum/923ad2150e1c601b0e96d0d8f35a1e239a55d6876cd37c48554eba4ea149df7b
+ jq -c .json_value
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1771  100  1771    0     0   3074      0 --:--:-- --:--:-- --:--:--  3074
++ jq -r '.fields[6].map[0].k.bytes' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ pkh0=af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3
++ jq -r '.fields[6].map[1].k.bytes' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ pkh1=84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268
++ jq -r '.fields[2].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jackpot=32740000
+ '[' p == p ']'
++ cat /home/lawrence/.local/keys/02.pkh
+ '[' af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3 == af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3 ']'
++ jq '.fields[6].map[0].v.int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ win_amount=16370000
++ jq '.fields[6].map[1].v.int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ sponsor_amount=16370000
+ new_jackpot=16370000
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c '
          .fields[6].map                |= [{"k":{"bytes":"84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268"},"v":{"int":16370000}}]
        | .fields[2].int                |= 16370000 
        '
+ '[' p == s ']'
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=29630000
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 1097911063 --tx-in e5c7a5852127b170a01848f075efe13122177deabf5d204e47beb252314e2c63#0 --tx-in dfb156a63cd09dadcdc05079785da5aae127755fdefca67d9f7007608d58587f#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-payout.json --tx-in-collateral 53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0 --tx-out 'addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp+29630000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --tx-out addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju+16370000 --change-address addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju --required-signer-hash af7a5b4a636f9ee1a4f8443a189ab7da4fdc799821bf5637e7e689d3 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.body
Estimated transaction fee: Lovelace 1531257
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.body --testnet-magic 1097911063 --signing-key-file /home/lawrence/.local/keys/02.skey --out-file /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.tx --testnet-magic 1097911063
Transaction successfully submitted.



lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
7e9f9a4a4a53b4bab8a1e3b98b725d34eeac45dd1f16a584e7ed4fa7a666ddd1     1        29630000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + TxOutDatumHash ScriptDataInAlonzoEra "8ccb8cdcd375c5d2f4454857e4f18e69ec5a866f4b2dab217af26f4b79281edb"

lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1vzhh5k62vdheacdylpzr5xy6kldylhrenqsm743hulngn5c34khju --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
193159312093d4b44d125f6d71db5a258e20f509307c12a9c32c847d3053f273     2        2000000 lovelace + 1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.3132 + TxOutDatumNone
37474e7ef56a84d4bc4b40a11b89898c2dbc11698e797349bbf44f3f11fe6730     2        2000000 lovelace + 1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.3139 + TxOutDatumNone
46b59d8603c958f1da52cf41fd4c26bb3ae780934fd3b4a53cbec6dcbb2aafc0     2        2000000 lovelace + 1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.3138 + TxOutDatumNone
503ea529e37a6182da3901a99b9bd5e7975b6c85021cafaaaba35a192f89258e     2        2000000 lovelace + 1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.313137 + TxOutDatumNone
53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67     0        10000000 lovelace + TxOutDatumNone
65b2f06529996c55e138378440ca88259e924a93ad931e654a3b7ba4921a2d0a     2        2000000 lovelace + 1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.3130 + TxOutDatumNone
76fba55f6401e6ceb24660df49af011e3e75b665984f02b5d07bdf36300f3b90     2        2000000 lovelace + 1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.3135 + TxOutDatumNone
7e9f9a4a4a53b4bab8a1e3b98b725d34eeac45dd1f16a584e7ed4fa7a666ddd1     0        38581080 lovelace + TxOutDatumNone
7e9f9a4a4a53b4bab8a1e3b98b725d34eeac45dd1f16a584e7ed4fa7a666ddd1     2        16370000 lovelace + TxOutDatumNone
80fc3c660669d2d4e5e5f3ff0f20fdf62492f46d8a417859f78dc23d4f0d9f8f     2        2000000 lovelace + 1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.3133 + TxOutDatumNone
961fa54ed6ba347068b71ef067907188c6fcaa4baf7f9a237848d29db9a13506     2        2000000 lovelace + 1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.3131 + TxOutDatumNone
ae2df2fad828c606b9e495ff3ab5c98414b7235fa9e6d73c3078c383b5d4a81e     2        2000000 lovelace + 1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.313132 + TxOutDatumNone
bbc5b5d0408520a40a7d23ce7fb1c840f2e42db3c7d1fd4168d8ec8f2e7b5d51     2        2000000 lovelace + 1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.3136 + TxOutDatumNone
c730858fb8c382ec77992cd5908f9385ef9e588e5590537bd6650cf40fbb00c3     2        2000000 lovelace + 1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.3134 + TxOutDatumNone
e5c7a5852127b170a01848f075efe13122177deabf5d204e47beb252314e2c63     2        2000000 lovelace + 1 b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0.3137 + TxOutDatumNone


+ '[' -z testnet ']'
+ ENV=testnet
+++ readlink -f ./payout-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/payout-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ export TESTNET_MAGIC=1097911063
++ TESTNET_MAGIC=1097911063
++ export ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ export PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ export SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
++ SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
+ echo 'Socket path: /home/lawrence/src/cardano-lottery/node.socket'
Socket path: /home/lawrence/src/cardano-lottery/node.socket
+ ls -al /home/lawrence/src/cardano-lottery/node.socket
srw------- 1 lawrence lawrence 0 May  6 08:15 /home/lawrence/src/cardano-lottery/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-utxo-in.json /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/close-utxo.json /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo-valid.out /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/redeemer-lotto-draw.json /home/lawrence/src/cardano-lottery/work/redeemer-lotto-redeem.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-burn.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/sponsor-utxo-valid.json /home/lawrence/src/cardano-lottery/work/sponsor-utxo.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/t.sh /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/win-nums.json /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --testnet-magic 1097911063
+ lotto_validator_script_addr=addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp
+ redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-payout.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-value.json
+ lotto_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
+ echo 'starting lotto payout'
starting lotto payout
+ '[' s == p ']'
+ '[' s == s ']'
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 1097911063 --payment-verification-key-file /home/lawrence/.local/keys/03.vkey
+ user_addr=addr_test1vzzrzjrckm7udfjm8jvfsw3t4w8zw989my85az49460sy6qmfy687
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vzzrzjrckm7udfjm8jvfsw3t4w8zw989my85az49460sy6qmfy687 --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/sponsor-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/sponsor-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray sponsor_utxo_valid_array
++ echo b00f79ea631f03d8eb6fa9e48380741b98687fdf0a1047f18890fe2f3237b994#0
++ tr -d '\n'
+ user_utxo_in=b00f79ea631f03d8eb6fa9e48380741b98687fdf0a1047f18890fe2f3237b994#0
+ user_collateral=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
++ cat /home/lawrence/.local/keys/03.pkh
+ user_pkh=84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268
+ user_skey=/home/lawrence/.local/keys/03.skey
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=7e9f9a4a4a53b4bab8a1e3b98b725d34eeac45dd1f16a584e7ed4fa7a666ddd1#1
+ '[' testnet == devnet ']'
+ '[' testnet == testnet ']'
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/addresses/addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp/utxos
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   611  100   611    0     0   3085      0 --:--:-- --:--:-- --:--:--  3085
++ jq -r '.[0].data_hash' /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json
+ datum_hash=8ccb8cdcd375c5d2f4454857e4f18e69ec5a866f4b2dab217af26f4b79281edb
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/scripts/datum/8ccb8cdcd375c5d2f4454857e4f18e69ec5a866f4b2dab217af26f4b79281edb
+ jq -c .json_value
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1675  100  1675    0     0   3336      0 --:--:-- --:--:-- --:--:--  3330
++ jq -r '.fields[6].map[0].k.bytes' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ pkh0=84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268
++ jq -r '.fields[6].map[1].k.bytes' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ pkh1=null
++ jq -r '.fields[2].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jackpot=16370000
+ '[' s == p ']'
+ '[' s == s ']'
++ cat /home/lawrence/.local/keys/03.pkh
+ '[' 84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268 == 84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268 ']'
++ jq '.fields[6].map[0].v.int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ win_amount=16370000
+ new_jackpot=0
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c '
        .fields[6].map                  |= []
        | .fields[2].int                |= 0 
        '
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=13260000
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 1097911063 --tx-in b00f79ea631f03d8eb6fa9e48380741b98687fdf0a1047f18890fe2f3237b994#0 --tx-in 7e9f9a4a4a53b4bab8a1e3b98b725d34eeac45dd1f16a584e7ed4fa7a666ddd1#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-payout.json --tx-in-collateral c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0 --tx-out 'addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp+13260000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --tx-out addr_test1vzzrzjrckm7udfjm8jvfsw3t4w8zw989my85az49460sy6qmfy687+16370000 --change-address addr_test1vzzrzjrckm7udfjm8jvfsw3t4w8zw989my85az49460sy6qmfy687 --required-signer-hash 84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.body
Estimated transaction fee: Lovelace 1517352
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.body --testnet-magic 1097911063 --signing-key-file /home/lawrence/.local/keys/03.skey --out-file /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.tx --testnet-magic 1097911063
Transaction successfully submitted.



lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1vzzrzjrckm7udfjm8jvfsw3t4w8zw989my85az49460sy6qmfy687 --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
56efa2c6144eff1adb6821cd7a371271c1a9d2f9869b881708d8193ab7754f05     0        5000000 lovelace + TxOutDatumNone
8888f1b7df2989075efe9e41f8850935262e5365bd84d5b09cfbf97c64c84134     0        18482648 lovelace + TxOutDatumNone
8888f1b7df2989075efe9e41f8850935262e5365bd84d5b09cfbf97c64c84134     2        16370000 lovelace + TxOutDatumNone
c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054     0        10000000 lovelace + TxOutDatumNone

lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
8888f1b7df2989075efe9e41f8850935262e5365bd84d5b09cfbf97c64c84134     1        13260000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + TxOutDatumHash ScriptDataInAlonzoEra "fddc2f7fd8f11c9bd59130e598980ccd0f174441249be7da303114353fc73184"


+ '[' -z testnet ']'
+ ENV=testnet
+++ readlink -f ./end-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/end-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ export TESTNET_MAGIC=1097911063
++ TESTNET_MAGIC=1097911063
++ export ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ export PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ export SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
++ SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
+ echo 'Socket path: /home/lawrence/src/cardano-lottery/node.socket'
Socket path: /home/lawrence/src/cardano-lottery/node.socket
+ ls -al /home/lawrence/src/cardano-lottery/node.socket
srw------- 1 lawrence lawrence 0 May  6 08:15 /home/lawrence/src/cardano-lottery/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-utxo-in.json /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/close-utxo.json /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo-valid.out /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/redeemer-lotto-draw.json /home/lawrence/src/cardano-lottery/work/redeemer-lotto-redeem.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-burn.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/sponsor-utxo-valid.json /home/lawrence/src/cardano-lottery/work/sponsor-utxo.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/t.sh /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/win-nums.json /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --testnet-magic 1097911063
+ lotto_validator_script_addr=addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp
+ redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-end.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ cat /home/lawrence/.local/keys/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
+ echo 'starting lotto end'
starting lotto end
+ echo 'Script: /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus'
Script: /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 1097911063 --payment-verification-key-file /home/lawrence/.local/keys/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo dfb156a63cd09dadcdc05079785da5aae127755fdefca67d9f7007608d58587f#0
++ tr -d '\n'
+ admin_utxo_in=dfb156a63cd09dadcdc05079785da5aae127755fdefca67d9f7007608d58587f#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=8888f1b7df2989075efe9e41f8850935262e5365bd84d5b09cfbf97c64c84134#1
+ '[' testnet == devnet ']'
+ '[' testnet == testnet ']'
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/addresses/addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp/utxos
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   611  100   611    0     0   2368      0 --:--:-- --:--:-- --:--:--  2368
++ jq -r '.[0].data_hash' /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json
+ datum_hash=fddc2f7fd8f11c9bd59130e598980ccd0f174441249be7da303114353fc73184
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/scripts/datum/fddc2f7fd8f11c9bd59130e598980ccd0f174441249be7da303114353fc73184
+ jq -c .json_value
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1573  100  1573    0     0   2416      0 --:--:-- --:--:-- --:--:--  2412
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c '
  .fields[1].list  |= [] 
| .fields[6].map   |= [] 
| .fields[7].int   |= 5 
| .fields[8].list  |= []'
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=13260000
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 1097911063 --tx-in dfb156a63cd09dadcdc05079785da5aae127755fdefca67d9f7007608d58587f#0 --tx-in 8888f1b7df2989075efe9e41f8850935262e5365bd84d5b09cfbf97c64c84134#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-end.json --tx-in-collateral 4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0 --tx-out 'addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp+13260000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/end-tx-alonzo.body
Estimated transaction fee: Lovelace 1360566
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/end-tx-alonzo.body --testnet-magic 1097911063 --signing-key-file /home/lawrence/.local/keys/01.skey --out-file /home/lawrence/src/cardano-lottery/work/end-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/end-tx-alonzo.tx --testnet-magic 1097911063
Transaction successfully submitted.



lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
0dd94a87c3a3f6a1ebd613545ca3377ba628e3a91dfc08e025331b542d18c6c5     1        13260000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + TxOutDatumHash ScriptDataInAlonzoEra "5a4213f9aec1ea6845b2f35fcfdd177a908ba30ceb48880b84238a64e1cda3cc"


+ '[' -z testnet ']'
+ ENV=testnet
+++ readlink -f ./open-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/open-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ export TESTNET_MAGIC=1097911063
++ TESTNET_MAGIC=1097911063
++ export ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ export PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ export SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
++ SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
+ echo 'Socket path: /home/lawrence/src/cardano-lottery/node.socket'
Socket path: /home/lawrence/src/cardano-lottery/node.socket
+ ls -al /home/lawrence/src/cardano-lottery/node.socket
srw------- 1 lawrence lawrence 0 May  6 08:15 /home/lawrence/src/cardano-lottery/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-utxo-in.json /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/calc-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/close-utxo.json /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/draw-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/end-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/end-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/payout-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo-valid.out /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/redeem-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/redeemer-lotto-draw.json /home/lawrence/src/cardano-lottery/work/redeemer-lotto-redeem.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-burn.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/sponsor-utxo-valid.json /home/lawrence/src/cardano-lottery/work/sponsor-utxo.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/t.sh /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/win-nums.json /home/lawrence/src/cardano-lottery/work-backup
+ ticket_cost=20000
+ additional_funding=10000000
+ fee_percentage=2
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.hash
+ lotto_validator_hash=82d97f70771a1dea9d02f28e2fb4146e2d984ed719e888daac7985bc
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --testnet-magic 1097911063
+ lotto_validator_script_addr=addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp
+ redeemer_file_path=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-open.json
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-val-addr.json
+ lotto_validator_addr='{"fields":[{"fields":[{"bytes":"82d97f70771a1dea9d02f28e2fb4146e2d984ed719e888daac7985bc"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-value.json
+ lotto_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-val-addr.json
+ buy_validator_addr='{"fields":[{"fields":[{"bytes":"65d5f1a5e5e08899ffee236b741b867da1e480213c2a12476f0f9d98"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-value.json
+ buy_token_value='{"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993"},"v":{"int":1}}]}}]}'
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/ticket-policy.hash
++ jq -r .bytes
+ ticket_mph=b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
++ cat /home/lawrence/.local/keys/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
++ cat /home/lawrence/.local/keys/03.pkh
+ sponsor_pkh=84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268
+ echo 'starting lotto open'
starting lotto open
+ echo 'Script: '
Script: 
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 1097911063 --payment-verification-key-file /home/lawrence/.local/keys/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 0dd94a87c3a3f6a1ebd613545ca3377ba628e3a91dfc08e025331b542d18c6c5#0
++ tr -d '\n'
+ admin_utxo_in=0dd94a87c3a3f6a1ebd613545ca3377ba628e3a91dfc08e025331b542d18c6c5#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=0dd94a87c3a3f6a1ebd613545ca3377ba628e3a91dfc08e025331b542d18c6c5#1
+ '[' testnet == devnet ']'
+ '[' testnet == testnet ']'
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/addresses/addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp/utxos
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   611  100   611    0     0   2043      0 --:--:-- --:--:-- --:--:--  2043
++ jq -r '.[0].data_hash' /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json
+ datum_hash=5a4213f9aec1ea6845b2f35fcfdd177a908ba30ceb48880b84238a64e1cda3cc
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/scripts/datum/5a4213f9aec1ea6845b2f35fcfdd177a908ba30ceb48880b84238a64e1cda3cc
+ jq -c .json_value
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1116  100  1116    0     0   2825      0 --:--:-- --:--:-- --:--:--  2818
++ jq -r '.fields[2].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jackpot=0
++ jq -r '.fields[3].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ seq_num=1
++ jq -r '.fields[4].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ treasury=12740000
+ [[ 0 -gt 12740000 ]]
+ new_jackpot=16370000
+ new_treasury=6370000
+ new_seq_num=2
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c '
  .fields[0].fields[0].bytes    |= "4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819"
| .fields[0].fields[1].bytes    |= "84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268"
| .fields[0].fields[2]          |= {"fields":[{"fields":[{"bytes":"82d97f70771a1dea9d02f28e2fb4146e2d984ed719e888daac7985bc"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}
| .fields[0].fields[3]          |= {"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6"},"v":{"int":1}}]}}]}
| .fields[0].fields[4]          |= {"fields":[{"fields":[{"bytes":"65d5f1a5e5e08899ffee236b741b867da1e480213c2a12476f0f9d98"}],"constructor":1},{"fields":[],"constructor":1}],"constructor":0}
| .fields[0].fields[5]          |= {"map":[{"k":{"bytes":"aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"},"v":{"map":[{"k":{"bytes":"11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993"},"v":{"int":1}}]}}]}
| .fields[0].fields[6].bytes    |= "b905dd9d98625f15cfe7dd59f8929a00fdc66c78508d9317e719d7f0"
| .fields[0].fields[7].int      |= 2
| .fields[0].fields[8].int      |= 20000
| .fields[1].list               |= [{"fields":[{"bytes":"84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268"},{"list":[]}], "constructor": 0}]
| .fields[2].int                |= 16370000
| .fields[3].int                |= 2
| .fields[4].int                |= 6370000
| .fields[6].map                |= [{"k":{"bytes":"84314878b6fdc6a65b3c98983a2bab8e2714e5d90f4e8aa5ae9f0268"},"v":{"int":0}}] 
| .fields[7].int                |= 1
| .fields[8].list               |= []'
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=23260000
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 1097911063 --tx-in 0dd94a87c3a3f6a1ebd613545ca3377ba628e3a91dfc08e025331b542d18c6c5#0 --tx-in 0dd94a87c3a3f6a1ebd613545ca3377ba628e3a91dfc08e025331b542d18c6c5#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-open.json --tx-in-collateral 4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0 --tx-out 'addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp+23260000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body
Estimated transaction fee: Lovelace 1504750
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body --testnet-magic 1097911063 --signing-key-file /home/lawrence/.local/keys/01.skey --out-file /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx --testnet-magic 1097911063
Transaction successfully submitted.

lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1wzpdjlmswudpm65aqteguta5z3hzmxzw6uv73zx643uct0q7yd8lp --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
334d0647c24e97c56aacbc3c403cfb1d570936a1024a2907e413c078b4d6002c     1        23260000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11d495a45a601d7fbfad401ad3bbe159b8c27436765ace0e5c2c5a65c20b3993 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.66614ea8465c04f5f357bdfecb6f300c3872e958fc79ca4c1900fb3a3cb0bfa6 + TxOutDatumHash ScriptDataInAlonzoEra "f6fbf8c50e0a5b7d05f2e3c2dcf9387e91a6e5ecd4d2506cbc2929e4b87afe8e"



lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1wryg98688h3e44pru04d9eszk8q0ae4urt8uz87gte6cxzctwr64q --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
52927d8b2e6d86e285366b7567fa15abe5349651c04fab5c4c1c54bb16b54f58     1        27000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.086eb10b693d3663558d2fa2a91fbf5c12ad93c94cd362fefce0cb8e00499ddf + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11175e5c0583d0d314b32aa3a848f9e0a1c52879f1c8835f54e30ef53b5b9d2d + TxOutDatumHash ScriptDataInAlonzoEra "8c01f24add1230e2f5664f8a06de4d41c245efeb0207876c1c67f24bf463ae48"
lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a     0        10000000 lovelace + TxOutDatumNone
52927d8b2e6d86e285366b7567fa15abe5349651c04fab5c4c1c54bb16b54f58     0        796784742 lovelace + TxOutDatumNone



+ '[' -z testnet ']'
+ ENV=testnet
+++ readlink -f ./collect-lotto-tx.sh
++ dirname /home/lawrence/src/cardano-lottery/scripts/cardano-cli/collect-lotto-tx.sh
+ MY_DIR=/home/lawrence/src/cardano-lottery/scripts/cardano-cli
+ source /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/global-export-variables.sh
++ set -e
++ set -o pipefail
++ export PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ PROJECT_ID=testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu
++ export BASE=/home/lawrence/src/cardano-lottery
++ BASE=/home/lawrence/src/cardano-lottery
++ export WORK=/home/lawrence/src/cardano-lottery/work
++ WORK=/home/lawrence/src/cardano-lottery/work
++ export CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ CARDANO_CLI=/home/lawrence/.local/bin/cardano-cli
++ export CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ CARDANO_NODE_SOCKET_PATH=/home/lawrence/src/cardano-lottery/node.socket
++ export TESTNET_MAGIC=1097911063
++ TESTNET_MAGIC=1097911063
++ export ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ ADMIN_VKEY=/home/lawrence/.local/keys/01.vkey
++ export ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ ADMIN_SKEY=/home/lawrence/.local/keys/01.skey
++ export ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ ADMIN_PKH=/home/lawrence/.local/keys/01.pkh
++ export PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ PLAYER_VKEY=/home/lawrence/.local/keys/02.vkey
++ export PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ PLAYER_SKEY=/home/lawrence/.local/keys/02.skey
++ export PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ PLAYER_PKH=/home/lawrence/.local/keys/02.pkh
++ export SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ SPONSOR_VKEY=/home/lawrence/.local/keys/03.vkey
++ export SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ SPONSOR_SKEY=/home/lawrence/.local/keys/03.skey
++ export SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ SPONSOR_PKH=/home/lawrence/.local/keys/03.pkh
++ export MIN_ADA_OUTPUT_TX=2000000
++ MIN_ADA_OUTPUT_TX=2000000
++ export COLLATERAL_ADA=10000000
++ COLLATERAL_ADA=10000000
++ export ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ ADMIN_COLLATERAL=4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0
++ export PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ PLAYER_COLLATERAL=53f53c2c6cd6b17db4c6b9c359bfc49e70a9b661d247d2988347fd2aa227ad67#0
++ export SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
++ SPONSOR_COLLATERAL=c248d582e29c03aa80d2288c0bad795f24abc5c027c078edef3a34890e5b3054#0
+ '[' testnet == mainnet ']'
+ network='--testnet-magic 1097911063'
+ echo 'Socket path: /home/lawrence/src/cardano-lottery/node.socket'
Socket path: /home/lawrence/src/cardano-lottery/node.socket
+ ls -al /home/lawrence/src/cardano-lottery/node.socket
srw------- 1 lawrence lawrence 0 May  6 08:15 /home/lawrence/src/cardano-lottery/node.socket
+ mkdir -p /home/lawrence/src/cardano-lottery/work
+ mkdir -p /home/lawrence/src/cardano-lottery/work-backup
+ cp -f /home/lawrence/src/cardano-lottery/work/admin-utxo-valid.json /home/lawrence/src/cardano-lottery/work/admin-utxo.json /home/lawrence/src/cardano-lottery/work/buy-datum-in.json /home/lawrence/src/cardano-lottery/work/buy-datum-out.json /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/buy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/buy-utxo-in.json /home/lawrence/src/cardano-lottery/work/buy-validator-utxo.json /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/close-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/init-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/open-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/player-utxo-valid.json /home/lawrence/src/cardano-lottery/work/player-utxo.json /home/lawrence/src/cardano-lottery/work/pparms.json /home/lawrence/src/cardano-lottery/work/redeemer-ticket-mint.json /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/startbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/stopbuy-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.body /home/lawrence/src/cardano-lottery/work/transfertoken-tx-alonzo.tx /home/lawrence/src/cardano-lottery/work-backup
+ /home/lawrence/.local/bin/cardano-cli query protocol-parameters --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/pparms.json
+ lotto_validator_script=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus
++ /home/lawrence/.local/bin/cardano-cli address build --payment-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --testnet-magic 1097911063
+ lotto_validator_script_addr=addr_test1wryg98688h3e44pru04d9eszk8q0ae4urt8uz87gte6cxzctwr64q
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-token-name.json
++ jq -r .bytes
+ lotto_token_name=11175e5c0583d0d314b32aa3a848f9e0a1c52879f1c8835f54e30ef53b5b9d2d
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/buy-token-name.json
++ jq -r .bytes
+ buy_token_name=086eb10b693d3663558d2fa2a91fbf5c12ad93c94cd362fefce0cb8e00499ddf
++ cat /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-thread-token-policy.hash
++ jq -r .bytes
+ thread_token_mph=aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b
+ redeemer_file=/home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-collect.json
++ cat /home/lawrence/.local/keys/01.pkh
+ admin_pkh=4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819
+ echo 'starting lotto collect'
starting lotto collect
++ /home/lawrence/.local/bin/cardano-cli address build --testnet-magic 1097911063 --payment-verification-key-file /home/lawrence/.local/keys/01.vkey
+ admin_utxo_addr=addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ cat /home/lawrence/src/cardano-lottery/work/admin-utxo.json
+ jq -r 'to_entries[] | select(.value.value.lovelace > 10000000 ) | .key'
+ readarray admin_utxo_valid_array
++ echo 52927d8b2e6d86e285366b7567fa15abe5349651c04fab5c4c1c54bb16b54f58#0
++ tr -d '\n'
+ admin_utxo_in=52927d8b2e6d86e285366b7567fa15abe5349651c04fab5c4c1c54bb16b54f58#0
+ /home/lawrence/.local/bin/cardano-cli query utxo --address addr_test1wryg98688h3e44pru04d9eszk8q0ae4urt8uz87gte6cxzctwr64q --testnet-magic 1097911063 --out-file /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
++ jq -r 'to_entries[] 
| select(.value.value."aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b"."11175e5c0583d0d314b32aa3a848f9e0a1c52879f1c8835f54e30ef53b5b9d2d") 
| .key' /home/lawrence/src/cardano-lottery/work/lotto-validator-utxo.json
+ lotto_validator_utxo_tx_in=52927d8b2e6d86e285366b7567fa15abe5349651c04fab5c4c1c54bb16b54f58#1
+ '[' testnet == devnet ']'
+ '[' testnet == testnet ']'
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/addresses/addr_test1wryg98688h3e44pru04d9eszk8q0ae4urt8uz87gte6cxzctwr64q/utxos
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   611  100   611    0     0   3748      0 --:--:-- --:--:-- --:--:--  3748
++ jq -r '.[0].data_hash' /home/lawrence/src/cardano-lottery/work/lotto-utxo-in.json
+ datum_hash=8c01f24add1230e2f5664f8a06de4d41c245efeb0207876c1c67f24bf463ae48
+ curl -H 'project_id: testnetOo1ri1RaUAfnslati2pZDrLPdnURwaBu' https://cardano-testnet.blockfrost.io/api/v0/scripts/datum/8c01f24add1230e2f5664f8a06de4d41c245efeb0207876c1c67f24bf463ae48
+ jq -c .json_value
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1316  100  1316    0     0   2680      0 --:--:-- --:--:-- --:--:--  2674
++ jq -r '.fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ fees=7000000
+ cat /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json
+ jq -c ' .fields[5].int  |= 0 '
++ jq -r '.fields[2].int + .fields[4].int + .fields[5].int' /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json
+ lotto_value=20000000
+ /home/lawrence/.local/bin/cardano-cli transaction build --alonzo-era --cardano-mode --testnet-magic 1097911063 --tx-in 52927d8b2e6d86e285366b7567fa15abe5349651c04fab5c4c1c54bb16b54f58#0 --tx-in 52927d8b2e6d86e285366b7567fa15abe5349651c04fab5c4c1c54bb16b54f58#1 --tx-in-script-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/lotto-validator.plutus --tx-in-datum-file /home/lawrence/src/cardano-lottery/work/lotto-datum-in.json --tx-in-redeemer-file /home/lawrence/src/cardano-lottery/scripts/cardano-cli/testnet/data/redeemer-lotto-collect.json --tx-in-collateral 4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a#0 --tx-out 'addr_test1wryg98688h3e44pru04d9eszk8q0ae4urt8uz87gte6cxzctwr64q+20000000 + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11175e5c0583d0d314b32aa3a848f9e0a1c52879f1c8835f54e30ef53b5b9d2d + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.086eb10b693d3663558d2fa2a91fbf5c12ad93c94cd362fefce0cb8e00499ddf' --tx-out-datum-embed-file /home/lawrence/src/cardano-lottery/work/lotto-datum-out.json --tx-out addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5+7000000 --change-address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --required-signer-hash 4ccdbf08ac0bd876fc9cf1ac03ed86ceef4052cde7a4989c59e87819 --protocol-params-file /home/lawrence/src/cardano-lottery/work/pparms.json --out-file /home/lawrence/src/cardano-lottery/work/collect-tx-alonzo.body
Estimated transaction fee: Lovelace 1393657
+ echo 'tx has been built'
tx has been built
+ /home/lawrence/.local/bin/cardano-cli transaction sign --tx-body-file /home/lawrence/src/cardano-lottery/work/collect-tx-alonzo.body --testnet-magic 1097911063 --signing-key-file /home/lawrence/.local/keys/01.skey --out-file /home/lawrence/src/cardano-lottery/work/collect-tx-alonzo.tx
+ echo 'tx has been signed'
tx has been signed
+ echo 'Submit the tx with plutus script and wait 5 seconds...'
Submit the tx with plutus script and wait 5 seconds...
+ /home/lawrence/.local/bin/cardano-cli transaction submit --tx-file /home/lawrence/src/cardano-lottery/work/collect-tx-alonzo.tx --testnet-magic 1097911063
Transaction successfully submitted.





lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1vpxvm0cg4s9asahunnc6cqldsm8w7szjehn6fxyut858sxgqvc3q5 --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
4bc07d353abd7ef6bca96162cab6d21e498791d82fcf6880a6440429f426308a     0        10000000 lovelace + TxOutDatumNone
82be1f055d3903607efffe99f4400600decffd6579e52e61453dbca3af762d6d     0        795391085 lovelace + TxOutDatumNone
82be1f055d3903607efffe99f4400600decffd6579e52e61453dbca3af762d6d     2        7000000 lovelace + TxOutDatumNone
lawrence@lawrence-MacBookAir:~/src/cardano-lottery$ cardano-cli query utxo --address addr_test1wryg98688h3e44pru04d9eszk8q0ae4urt8uz87gte6cxzctwr64q --cardano-mode --testnet-magic 1097911063
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
82be1f055d3903607efffe99f4400600decffd6579e52e61453dbca3af762d6d     1        20000000 lovelace + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.086eb10b693d3663558d2fa2a91fbf5c12ad93c94cd362fefce0cb8e00499ddf + 1 aa35880213f8b370be5c7b55225c18ab6fd2204e2f87d48a4701e02b.11175e5c0583d0d314b32aa3a848f9e0a1c52879f1c8835f54e30ef53b5b9d2d + TxOutDatumHash ScriptDataInAlonzoEra "adcecd03ea4b5857568977ab815b677f10a19c71e42a4a99550977b03c3cc536"








